   1               		.file	"action_tapping.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__tmp_reg__ = 0
   6               	__zero_reg__ = 1
   7               		.text
   8               	.Ltext0:
   9               		.cfi_sections	.debug_frame
  10               		.section	.text.debug_waiting_buffer,"ax",@progbits
  12               	debug_waiting_buffer:
  13               	.LFB13:
  14               		.file 1 "tmk_core/common/action_tapping.c"
   1:tmk_core/common/action_tapping.c **** #include <stdint.h>
   2:tmk_core/common/action_tapping.c **** #include <stdbool.h>
   3:tmk_core/common/action_tapping.c **** #include "action.h"
   4:tmk_core/common/action_tapping.c **** #include "action_layer.h"
   5:tmk_core/common/action_tapping.c **** #include "action_tapping.h"
   6:tmk_core/common/action_tapping.c **** #include "keycode.h"
   7:tmk_core/common/action_tapping.c **** #include "timer.h"
   8:tmk_core/common/action_tapping.c **** 
   9:tmk_core/common/action_tapping.c **** #ifdef DEBUG_ACTION
  10:tmk_core/common/action_tapping.c **** #include "debug.h"
  11:tmk_core/common/action_tapping.c **** #else
  12:tmk_core/common/action_tapping.c **** #include "nodebug.h"
  13:tmk_core/common/action_tapping.c **** #endif
  14:tmk_core/common/action_tapping.c **** 
  15:tmk_core/common/action_tapping.c **** #ifndef NO_ACTION_TAPPING
  16:tmk_core/common/action_tapping.c **** 
  17:tmk_core/common/action_tapping.c **** #define IS_TAPPING()            !IS_NOEVENT(tapping_key.event)
  18:tmk_core/common/action_tapping.c **** #define IS_TAPPING_PRESSED()    (IS_TAPPING() && tapping_key.event.pressed)
  19:tmk_core/common/action_tapping.c **** #define IS_TAPPING_RELEASED()   (IS_TAPPING() && !tapping_key.event.pressed)
  20:tmk_core/common/action_tapping.c **** #define IS_TAPPING_KEY(k)       (IS_TAPPING() && KEYEQ(tapping_key.event.key, (k)))
  21:tmk_core/common/action_tapping.c **** 
  22:tmk_core/common/action_tapping.c **** __attribute__ ((weak))
  23:tmk_core/common/action_tapping.c **** uint16_t get_tapping_term(uint16_t keycode) {
  24:tmk_core/common/action_tapping.c ****   return TAPPING_TERM;
  25:tmk_core/common/action_tapping.c **** }
  26:tmk_core/common/action_tapping.c **** 
  27:tmk_core/common/action_tapping.c **** #ifdef TAPPING_TERM_PER_KEY
  28:tmk_core/common/action_tapping.c **** #define WITHIN_TAPPING_TERM(e)  (TIMER_DIFF_16(e.time, tapping_key.event.time) < get_tapping_term(g
  29:tmk_core/common/action_tapping.c **** #else
  30:tmk_core/common/action_tapping.c **** #define WITHIN_TAPPING_TERM(e)  (TIMER_DIFF_16(e.time, tapping_key.event.time) < TAPPING_TERM)
  31:tmk_core/common/action_tapping.c **** #endif
  32:tmk_core/common/action_tapping.c **** 
  33:tmk_core/common/action_tapping.c **** static keyrecord_t tapping_key = {};
  34:tmk_core/common/action_tapping.c **** static keyrecord_t waiting_buffer[WAITING_BUFFER_SIZE] = {};
  35:tmk_core/common/action_tapping.c **** static uint8_t waiting_buffer_head = 0;
  36:tmk_core/common/action_tapping.c **** static uint8_t waiting_buffer_tail = 0;
  37:tmk_core/common/action_tapping.c **** 
  38:tmk_core/common/action_tapping.c **** static bool process_tapping(keyrecord_t *record);
  39:tmk_core/common/action_tapping.c **** static bool waiting_buffer_enq(keyrecord_t record);
  40:tmk_core/common/action_tapping.c **** static void waiting_buffer_clear(void);
  41:tmk_core/common/action_tapping.c **** static bool waiting_buffer_typed(keyevent_t event);
  42:tmk_core/common/action_tapping.c **** static bool waiting_buffer_has_anykey_pressed(void);
  43:tmk_core/common/action_tapping.c **** static void waiting_buffer_scan_tap(void);
  44:tmk_core/common/action_tapping.c **** static void debug_tapping_key(void);
  45:tmk_core/common/action_tapping.c **** static void debug_waiting_buffer(void);
  46:tmk_core/common/action_tapping.c **** 
  47:tmk_core/common/action_tapping.c **** 
  48:tmk_core/common/action_tapping.c **** /** \brief Action Tapping Process
  49:tmk_core/common/action_tapping.c ****  *
  50:tmk_core/common/action_tapping.c ****  * FIXME: Needs doc
  51:tmk_core/common/action_tapping.c ****  */
  52:tmk_core/common/action_tapping.c **** void action_tapping_process(keyrecord_t record)
  53:tmk_core/common/action_tapping.c **** {
  54:tmk_core/common/action_tapping.c ****     if (process_tapping(&record)) {
  55:tmk_core/common/action_tapping.c ****         if (!IS_NOEVENT(record.event)) {
  56:tmk_core/common/action_tapping.c ****             debug("processed: "); debug_record(record); debug("\n");
  57:tmk_core/common/action_tapping.c ****         }
  58:tmk_core/common/action_tapping.c ****     } else {
  59:tmk_core/common/action_tapping.c ****         if (!waiting_buffer_enq(record)) {
  60:tmk_core/common/action_tapping.c ****             // clear all in case of overflow.
  61:tmk_core/common/action_tapping.c ****             debug("OVERFLOW: CLEAR ALL STATES\n");
  62:tmk_core/common/action_tapping.c ****             clear_keyboard();
  63:tmk_core/common/action_tapping.c ****             waiting_buffer_clear();
  64:tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
  65:tmk_core/common/action_tapping.c ****         }
  66:tmk_core/common/action_tapping.c ****     }
  67:tmk_core/common/action_tapping.c **** 
  68:tmk_core/common/action_tapping.c ****     // process waiting_buffer
  69:tmk_core/common/action_tapping.c ****     if (!IS_NOEVENT(record.event) && waiting_buffer_head != waiting_buffer_tail) {
  70:tmk_core/common/action_tapping.c ****         debug("---- action_exec: process waiting_buffer -----\n");
  71:tmk_core/common/action_tapping.c ****     }
  72:tmk_core/common/action_tapping.c ****     for (; waiting_buffer_tail != waiting_buffer_head; waiting_buffer_tail = (waiting_buffer_tail +
  73:tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
  74:tmk_core/common/action_tapping.c ****             debug("processed: waiting_buffer["); debug_dec(waiting_buffer_tail); debug("] = ");
  75:tmk_core/common/action_tapping.c ****             debug_record(waiting_buffer[waiting_buffer_tail]); debug("\n\n");
  76:tmk_core/common/action_tapping.c ****         } else {
  77:tmk_core/common/action_tapping.c ****             break;
  78:tmk_core/common/action_tapping.c ****         }
  79:tmk_core/common/action_tapping.c ****     }
  80:tmk_core/common/action_tapping.c ****     if (!IS_NOEVENT(record.event)) {
  81:tmk_core/common/action_tapping.c ****         debug("\n");
  82:tmk_core/common/action_tapping.c ****     }
  83:tmk_core/common/action_tapping.c **** }
  84:tmk_core/common/action_tapping.c **** 
  85:tmk_core/common/action_tapping.c **** 
  86:tmk_core/common/action_tapping.c **** /** \brief Tapping
  87:tmk_core/common/action_tapping.c ****  *
  88:tmk_core/common/action_tapping.c ****  * Rule: Tap key is typed(pressed and released) within TAPPING_TERM.
  89:tmk_core/common/action_tapping.c ****  *       (without interfering by typing other key)
  90:tmk_core/common/action_tapping.c ****  */
  91:tmk_core/common/action_tapping.c **** /* return true when key event is processed or consumed. */
  92:tmk_core/common/action_tapping.c **** bool process_tapping(keyrecord_t *keyp)
  93:tmk_core/common/action_tapping.c **** {
  94:tmk_core/common/action_tapping.c ****     keyevent_t event = keyp->event;
  95:tmk_core/common/action_tapping.c **** 
  96:tmk_core/common/action_tapping.c ****     // if tapping
  97:tmk_core/common/action_tapping.c ****     if (IS_TAPPING_PRESSED()) {
  98:tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
  99:tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 100:tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
 101:tmk_core/common/action_tapping.c ****                     // first tap!
 102:tmk_core/common/action_tapping.c ****                     debug("Tapping: First tap(0->1).\n");
 103:tmk_core/common/action_tapping.c ****                     tapping_key.tap.count = 1;
 104:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 105:tmk_core/common/action_tapping.c ****                     process_record(&tapping_key);
 106:tmk_core/common/action_tapping.c **** 
 107:tmk_core/common/action_tapping.c ****                     // copy tapping state
 108:tmk_core/common/action_tapping.c ****                     keyp->tap = tapping_key.tap;
 109:tmk_core/common/action_tapping.c ****                     // enqueue
 110:tmk_core/common/action_tapping.c ****                     return false;
 111:tmk_core/common/action_tapping.c ****                 }
 112:tmk_core/common/action_tapping.c ****                 /* Process a key typed within TAPPING_TERM
 113:tmk_core/common/action_tapping.c ****                  * This can register the key before settlement of tapping,
 114:tmk_core/common/action_tapping.c ****                  * useful for long TAPPING_TERM but may prevent fast typing.
 115:tmk_core/common/action_tapping.c ****                  */
 116:tmk_core/common/action_tapping.c **** #if defined(TAPPING_TERM_PER_KEY) || (!defined(PER_KEY_TAPPING_TERM) && TAPPING_TERM >= 500) || def
 117:tmk_core/common/action_tapping.c **** #ifdef TAPPING_TERM_PER_KEY
 118:tmk_core/common/action_tapping.c ****                 else if ( ( get_tapping_term(get_event_keycode(tapping_key.event)) >= 500) && IS_RE
 119:tmk_core/common/action_tapping.c **** #else
 120:tmk_core/common/action_tapping.c ****                 else if ( IS_RELEASED(event) && waiting_buffer_typed(event))
 121:tmk_core/common/action_tapping.c **** #endif
 122:tmk_core/common/action_tapping.c ****                 {
 123:tmk_core/common/action_tapping.c ****                     debug("Tapping: End. No tap. Interfered by typing key\n");
 124:tmk_core/common/action_tapping.c ****                     process_record(&tapping_key);
 125:tmk_core/common/action_tapping.c ****                     tapping_key = (keyrecord_t){};
 126:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 127:tmk_core/common/action_tapping.c ****                     // enqueue
 128:tmk_core/common/action_tapping.c ****                     return false;
 129:tmk_core/common/action_tapping.c ****                 }
 130:tmk_core/common/action_tapping.c **** #endif
 131:tmk_core/common/action_tapping.c ****                 /* Process release event of a key pressed before tapping starts
 132:tmk_core/common/action_tapping.c ****                  * Without this unexpected repeating will occur with having fast repeating setting
 133:tmk_core/common/action_tapping.c ****                  * https://github.com/tmk/tmk_keyboard/issues/60
 134:tmk_core/common/action_tapping.c ****                  */
 135:tmk_core/common/action_tapping.c ****                 else if (IS_RELEASED(event) && !waiting_buffer_typed(event)) {
 136:tmk_core/common/action_tapping.c ****                     // Modifier should be retained till end of this tapping.
 137:tmk_core/common/action_tapping.c ****                     action_t action = layer_switch_get_action(event.key);
 138:tmk_core/common/action_tapping.c ****                     switch (action.kind.id) {
 139:tmk_core/common/action_tapping.c ****                         case ACT_LMODS:
 140:tmk_core/common/action_tapping.c ****                         case ACT_RMODS:
 141:tmk_core/common/action_tapping.c ****                             if (action.key.mods && !action.key.code) return false;
 142:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 143:tmk_core/common/action_tapping.c ****                             break;
 144:tmk_core/common/action_tapping.c ****                         case ACT_LMODS_TAP:
 145:tmk_core/common/action_tapping.c ****                         case ACT_RMODS_TAP:
 146:tmk_core/common/action_tapping.c ****                             if (action.key.mods && keyp->tap.count == 0) return false;
 147:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 148:tmk_core/common/action_tapping.c ****                             break;
 149:tmk_core/common/action_tapping.c ****                     }
 150:tmk_core/common/action_tapping.c ****                     // Release of key should be process immediately.
 151:tmk_core/common/action_tapping.c ****                     debug("Tapping: release event of a key pressed before tapping\n");
 152:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 153:tmk_core/common/action_tapping.c ****                     return true;
 154:tmk_core/common/action_tapping.c ****                 }
 155:tmk_core/common/action_tapping.c ****                 else {
 156:tmk_core/common/action_tapping.c ****                     // set interrupted flag when other key preesed during tapping
 157:tmk_core/common/action_tapping.c ****                     if (event.pressed) {
 158:tmk_core/common/action_tapping.c ****                         tapping_key.tap.interrupted = true;
 159:tmk_core/common/action_tapping.c ****                     }
 160:tmk_core/common/action_tapping.c ****                     // enqueue
 161:tmk_core/common/action_tapping.c ****                     return false;
 162:tmk_core/common/action_tapping.c ****                 }
 163:tmk_core/common/action_tapping.c ****             }
 164:tmk_core/common/action_tapping.c ****             // tap_count > 0
 165:tmk_core/common/action_tapping.c ****             else {
 166:tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
 167:tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release("); debug_dec(tapping_key.tap.count); debug(")\n");
 168:tmk_core/common/action_tapping.c ****                     keyp->tap = tapping_key.tap;
 169:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 170:tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 171:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 172:tmk_core/common/action_tapping.c ****                     return true;
 173:tmk_core/common/action_tapping.c ****                 }
 174:tmk_core/common/action_tapping.c ****                 else if (is_tap_key(event.key) && event.pressed) {
 175:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 176:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last tap(>1).\n");
 177:tmk_core/common/action_tapping.c ****                         // unregister key
 178:tmk_core/common/action_tapping.c ****                         process_record(&(keyrecord_t){
 179:tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 180:tmk_core/common/action_tapping.c ****                                 .event.key = tapping_key.event.key,
 181:tmk_core/common/action_tapping.c ****                                 .event.time = event.time,
 182:tmk_core/common/action_tapping.c ****                                 .event.pressed = false
 183:tmk_core/common/action_tapping.c ****                         });
 184:tmk_core/common/action_tapping.c ****                     } else {
 185:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start while last tap(1).\n");
 186:tmk_core/common/action_tapping.c ****                     }
 187:tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 188:tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 189:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 190:tmk_core/common/action_tapping.c ****                     return true;
 191:tmk_core/common/action_tapping.c ****                 }
 192:tmk_core/common/action_tapping.c ****                 else {
 193:tmk_core/common/action_tapping.c ****                     if (!IS_NOEVENT(event)) {
 194:tmk_core/common/action_tapping.c ****                         debug("Tapping: key event while last tap(>0).\n");
 195:tmk_core/common/action_tapping.c ****                     }
 196:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 197:tmk_core/common/action_tapping.c ****                     return true;
 198:tmk_core/common/action_tapping.c ****                 }
 199:tmk_core/common/action_tapping.c ****             }
 200:tmk_core/common/action_tapping.c ****         }
 201:tmk_core/common/action_tapping.c ****         // after TAPPING_TERM
 202:tmk_core/common/action_tapping.c ****         else {
 203:tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 204:tmk_core/common/action_tapping.c ****                 debug("Tapping: End. Timeout. Not tap(0): ");
 205:tmk_core/common/action_tapping.c ****                 debug_event(event); debug("\n");
 206:tmk_core/common/action_tapping.c ****                 process_record(&tapping_key);
 207:tmk_core/common/action_tapping.c ****                 tapping_key = (keyrecord_t){};
 208:tmk_core/common/action_tapping.c ****                 debug_tapping_key();
 209:tmk_core/common/action_tapping.c ****                 return false;
 210:tmk_core/common/action_tapping.c ****             }  else {
 211:tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
 212:tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 213:tmk_core/common/action_tapping.c ****                     keyp->tap = tapping_key.tap;
 214:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 215:tmk_core/common/action_tapping.c ****                     tapping_key = (keyrecord_t){};
 216:tmk_core/common/action_tapping.c ****                     return true;
 217:tmk_core/common/action_tapping.c ****                 }
 218:tmk_core/common/action_tapping.c ****                 else if (is_tap_key(event.key) && event.pressed) {
 219:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 220:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last timeout tap(>1).\n");
 221:tmk_core/common/action_tapping.c ****                         // unregister key
 222:tmk_core/common/action_tapping.c ****                         process_record(&(keyrecord_t){
 223:tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 224:tmk_core/common/action_tapping.c ****                                 .event.key = tapping_key.event.key,
 225:tmk_core/common/action_tapping.c ****                                 .event.time = event.time,
 226:tmk_core/common/action_tapping.c ****                                 .event.pressed = false
 227:tmk_core/common/action_tapping.c ****                         });
 228:tmk_core/common/action_tapping.c ****                     } else {
 229:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start while last timeout tap(1).\n");
 230:tmk_core/common/action_tapping.c ****                     }
 231:tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 232:tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 233:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 234:tmk_core/common/action_tapping.c ****                     return true;
 235:tmk_core/common/action_tapping.c ****                 }
 236:tmk_core/common/action_tapping.c ****                 else {
 237:tmk_core/common/action_tapping.c ****                     if (!IS_NOEVENT(event)) {
 238:tmk_core/common/action_tapping.c ****                         debug("Tapping: key event while last timeout tap(>0).\n");
 239:tmk_core/common/action_tapping.c ****                     }
 240:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 241:tmk_core/common/action_tapping.c ****                     return true;
 242:tmk_core/common/action_tapping.c ****                 }
 243:tmk_core/common/action_tapping.c ****             }
 244:tmk_core/common/action_tapping.c ****         }
 245:tmk_core/common/action_tapping.c ****     } else if (IS_TAPPING_RELEASED()) {
 246:tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 247:tmk_core/common/action_tapping.c ****             if (event.pressed) {
 248:tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key)) {
 249:tmk_core/common/action_tapping.c **** #ifndef TAPPING_FORCE_HOLD
 250:tmk_core/common/action_tapping.c ****                     if (!tapping_key.tap.interrupted && tapping_key.tap.count > 0) {
 251:tmk_core/common/action_tapping.c ****                         // sequential tap.
 252:tmk_core/common/action_tapping.c ****                         keyp->tap = tapping_key.tap;
 253:tmk_core/common/action_tapping.c ****                         if (keyp->tap.count < 15) keyp->tap.count += 1;
 254:tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press("); debug_dec(keyp->tap.count); debug(")\n");
 255:tmk_core/common/action_tapping.c ****                         process_record(keyp);
 256:tmk_core/common/action_tapping.c ****                         tapping_key = *keyp;
 257:tmk_core/common/action_tapping.c ****                         debug_tapping_key();
 258:tmk_core/common/action_tapping.c ****                         return true;
 259:tmk_core/common/action_tapping.c ****                     }
 260:tmk_core/common/action_tapping.c **** #endif
 261:tmk_core/common/action_tapping.c ****                     // FIX: start new tap again
 262:tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 263:tmk_core/common/action_tapping.c ****                     return true;
 264:tmk_core/common/action_tapping.c ****                 } else if (is_tap_key(event.key)) {
 265:tmk_core/common/action_tapping.c ****                     // Sequential tap can be interfered with other tap key.
 266:tmk_core/common/action_tapping.c ****                     debug("Tapping: Start with interfering other tap.\n");
 267:tmk_core/common/action_tapping.c ****                     tapping_key = *keyp;
 268:tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 269:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 270:tmk_core/common/action_tapping.c ****                     return true;
 271:tmk_core/common/action_tapping.c ****                 } else {
 272:tmk_core/common/action_tapping.c ****                     // should none in buffer
 273:tmk_core/common/action_tapping.c ****                     // FIX: interrupted when other key is pressed
 274:tmk_core/common/action_tapping.c ****                     tapping_key.tap.interrupted = true;
 275:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 276:tmk_core/common/action_tapping.c ****                     return true;
 277:tmk_core/common/action_tapping.c ****                 }
 278:tmk_core/common/action_tapping.c ****             } else {
 279:tmk_core/common/action_tapping.c ****                 if (!IS_NOEVENT(event)) debug("Tapping: other key just after tap.\n");
 280:tmk_core/common/action_tapping.c ****                 process_record(keyp);
 281:tmk_core/common/action_tapping.c ****                 return true;
 282:tmk_core/common/action_tapping.c ****             }
 283:tmk_core/common/action_tapping.c ****         } else {
 284:tmk_core/common/action_tapping.c ****             // FIX: process_action here?
 285:tmk_core/common/action_tapping.c ****             // timeout. no sequential tap.
 286:tmk_core/common/action_tapping.c ****             debug("Tapping: End(Timeout after releasing last tap): ");
 287:tmk_core/common/action_tapping.c ****             debug_event(event); debug("\n");
 288:tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
 289:tmk_core/common/action_tapping.c ****             debug_tapping_key();
 290:tmk_core/common/action_tapping.c ****             return false;
 291:tmk_core/common/action_tapping.c ****         }
 292:tmk_core/common/action_tapping.c ****     }
 293:tmk_core/common/action_tapping.c ****     // not tapping state
 294:tmk_core/common/action_tapping.c ****     else {
 295:tmk_core/common/action_tapping.c ****         if (event.pressed && is_tap_key(event.key)) {
 296:tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 297:tmk_core/common/action_tapping.c ****             tapping_key = *keyp;
 298:tmk_core/common/action_tapping.c ****             process_record_tap_hint(&tapping_key);
 299:tmk_core/common/action_tapping.c ****             waiting_buffer_scan_tap();
 300:tmk_core/common/action_tapping.c ****             debug_tapping_key();
 301:tmk_core/common/action_tapping.c ****             return true;
 302:tmk_core/common/action_tapping.c ****         } else {
 303:tmk_core/common/action_tapping.c ****             process_record(keyp);
 304:tmk_core/common/action_tapping.c ****             return true;
 305:tmk_core/common/action_tapping.c ****         }
 306:tmk_core/common/action_tapping.c ****     }
 307:tmk_core/common/action_tapping.c **** }
 308:tmk_core/common/action_tapping.c **** 
 309:tmk_core/common/action_tapping.c **** 
 310:tmk_core/common/action_tapping.c **** /** \brief Waiting buffer enq
 311:tmk_core/common/action_tapping.c ****  *
 312:tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 313:tmk_core/common/action_tapping.c ****  */
 314:tmk_core/common/action_tapping.c **** bool waiting_buffer_enq(keyrecord_t record)
 315:tmk_core/common/action_tapping.c **** {
 316:tmk_core/common/action_tapping.c ****     if (IS_NOEVENT(record.event)) {
 317:tmk_core/common/action_tapping.c ****         return true;
 318:tmk_core/common/action_tapping.c ****     }
 319:tmk_core/common/action_tapping.c **** 
 320:tmk_core/common/action_tapping.c ****     if ((waiting_buffer_head + 1) % WAITING_BUFFER_SIZE == waiting_buffer_tail) {
 321:tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 322:tmk_core/common/action_tapping.c ****         return false;
 323:tmk_core/common/action_tapping.c ****     }
 324:tmk_core/common/action_tapping.c **** 
 325:tmk_core/common/action_tapping.c ****     waiting_buffer[waiting_buffer_head] = record;
 326:tmk_core/common/action_tapping.c ****     waiting_buffer_head = (waiting_buffer_head + 1) % WAITING_BUFFER_SIZE;
 327:tmk_core/common/action_tapping.c **** 
 328:tmk_core/common/action_tapping.c ****     debug("waiting_buffer_enq: "); debug_waiting_buffer();
 329:tmk_core/common/action_tapping.c ****     return true;
 330:tmk_core/common/action_tapping.c **** }
 331:tmk_core/common/action_tapping.c **** 
 332:tmk_core/common/action_tapping.c **** /** \brief Waiting buffer clear
 333:tmk_core/common/action_tapping.c ****  *
 334:tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 335:tmk_core/common/action_tapping.c ****  */
 336:tmk_core/common/action_tapping.c **** void waiting_buffer_clear(void)
 337:tmk_core/common/action_tapping.c **** {
 338:tmk_core/common/action_tapping.c ****     waiting_buffer_head = 0;
 339:tmk_core/common/action_tapping.c ****     waiting_buffer_tail = 0;
 340:tmk_core/common/action_tapping.c **** }
 341:tmk_core/common/action_tapping.c **** 
 342:tmk_core/common/action_tapping.c **** /** \brief Waiting buffer typed
 343:tmk_core/common/action_tapping.c ****  *
 344:tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 345:tmk_core/common/action_tapping.c ****  */
 346:tmk_core/common/action_tapping.c **** bool waiting_buffer_typed(keyevent_t event)
 347:tmk_core/common/action_tapping.c **** {
 348:tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
 349:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 350:tmk_core/common/action_tapping.c ****             return true;
 351:tmk_core/common/action_tapping.c ****         }
 352:tmk_core/common/action_tapping.c ****     }
 353:tmk_core/common/action_tapping.c ****     return false;
 354:tmk_core/common/action_tapping.c **** }
 355:tmk_core/common/action_tapping.c **** 
 356:tmk_core/common/action_tapping.c **** /** \brief Waiting buffer has anykey pressed
 357:tmk_core/common/action_tapping.c ****  *
 358:tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 359:tmk_core/common/action_tapping.c ****  */
 360:tmk_core/common/action_tapping.c **** __attribute__((unused))
 361:tmk_core/common/action_tapping.c **** bool waiting_buffer_has_anykey_pressed(void)
 362:tmk_core/common/action_tapping.c **** {
 363:tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
 364:tmk_core/common/action_tapping.c ****         if (waiting_buffer[i].event.pressed) return true;
 365:tmk_core/common/action_tapping.c ****     }
 366:tmk_core/common/action_tapping.c ****     return false;
 367:tmk_core/common/action_tapping.c **** }
 368:tmk_core/common/action_tapping.c **** 
 369:tmk_core/common/action_tapping.c **** /** \brief Scan buffer for tapping
 370:tmk_core/common/action_tapping.c ****  *
 371:tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 372:tmk_core/common/action_tapping.c ****  */
 373:tmk_core/common/action_tapping.c **** void waiting_buffer_scan_tap(void)
 374:tmk_core/common/action_tapping.c **** {
 375:tmk_core/common/action_tapping.c ****     // tapping already is settled
 376:tmk_core/common/action_tapping.c ****     if (tapping_key.tap.count > 0) return;
 377:tmk_core/common/action_tapping.c ****     // invalid state: tapping_key released && tap.count == 0
 378:tmk_core/common/action_tapping.c ****     if (!tapping_key.event.pressed) return;
 379:tmk_core/common/action_tapping.c **** 
 380:tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
 381:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 382:tmk_core/common/action_tapping.c ****                 !waiting_buffer[i].event.pressed &&
 383:tmk_core/common/action_tapping.c ****                 WITHIN_TAPPING_TERM(waiting_buffer[i].event)) {
 384:tmk_core/common/action_tapping.c ****             tapping_key.tap.count = 1;
 385:tmk_core/common/action_tapping.c ****             waiting_buffer[i].tap.count = 1;
 386:tmk_core/common/action_tapping.c ****             process_record(&tapping_key);
 387:tmk_core/common/action_tapping.c **** 
 388:tmk_core/common/action_tapping.c ****             debug("waiting_buffer_scan_tap: found at ["); debug_dec(i); debug("]\n");
 389:tmk_core/common/action_tapping.c ****             debug_waiting_buffer();
 390:tmk_core/common/action_tapping.c ****             return;
 391:tmk_core/common/action_tapping.c ****         }
 392:tmk_core/common/action_tapping.c ****     }
 393:tmk_core/common/action_tapping.c **** }
 394:tmk_core/common/action_tapping.c **** 
 395:tmk_core/common/action_tapping.c **** 
 396:tmk_core/common/action_tapping.c **** /** \brief Tapping key debug print
 397:tmk_core/common/action_tapping.c ****  *
 398:tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 399:tmk_core/common/action_tapping.c ****  */
 400:tmk_core/common/action_tapping.c **** static void debug_tapping_key(void)
 401:tmk_core/common/action_tapping.c **** {
 402:tmk_core/common/action_tapping.c ****     debug("TAPPING_KEY="); debug_record(tapping_key); debug("\n");
 403:tmk_core/common/action_tapping.c **** }
 404:tmk_core/common/action_tapping.c **** 
 405:tmk_core/common/action_tapping.c **** /** \brief Waiting buffer debug print
 406:tmk_core/common/action_tapping.c ****  *
 407:tmk_core/common/action_tapping.c ****  * FIXME: Needs docs
 408:tmk_core/common/action_tapping.c ****  */
 409:tmk_core/common/action_tapping.c **** static void debug_waiting_buffer(void)
 410:tmk_core/common/action_tapping.c **** {
  15               		.loc 1 410 1 view -0
  16               		.cfi_startproc
  17 0000 1F93      		push r17
  18               	.LCFI0:
  19               		.cfi_def_cfa_offset 3
  20               		.cfi_offset 17, -2
  21 0002 CF93      		push r28
  22               	.LCFI1:
  23               		.cfi_def_cfa_offset 4
  24               		.cfi_offset 28, -3
  25 0004 DF93      		push r29
  26               	.LCFI2:
  27               		.cfi_def_cfa_offset 5
  28               		.cfi_offset 29, -4
  29               	/* prologue: function */
  30               	/* frame size = 0 */
  31               	/* stack size = 3 */
  32               	.L__stack_usage = 3
 411:tmk_core/common/action_tapping.c ****     debug("{ ");
  33               		.loc 1 411 16 view .LVU1
 412:tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
  34               		.loc 1 412 5 view .LVU2
  35               	.LBB3:
  36               		.loc 1 412 10 view .LVU3
  37               		.loc 1 412 18 is_stmt 0 view .LVU4
  38 0006 C091 0000 		lds r28,waiting_buffer_tail
  39               	.LVL0:
 413:tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  40               		.loc 1 413 48 view .LVU5
  41 000a 16E0      		ldi r17,lo8(6)
  42               	.LVL1:
  43               	.L2:
 412:tmk_core/common/action_tapping.c ****     for (uint8_t i = waiting_buffer_tail; i != waiting_buffer_head; i = (i + 1) % WAITING_BUFFER_SI
  44               		.loc 1 412 5 discriminator 1 view .LVU6
  45 000c 8091 0000 		lds r24,waiting_buffer_head
  46 0010 8C13      		cpse r24,r28
  47 0012 00C0      		rjmp .L3
  48               	/* epilogue start */
  49               	.LBE3:
 414:tmk_core/common/action_tapping.c ****     }
 415:tmk_core/common/action_tapping.c ****     debug("}\n");
 416:tmk_core/common/action_tapping.c **** }
  50               		.loc 1 416 1 view .LVU7
  51 0014 DF91      		pop r29
  52 0016 CF91      		pop r28
  53               	.LVL2:
  54               		.loc 1 416 1 view .LVU8
  55 0018 1F91      		pop r17
  56 001a 0895      		ret
  57               	.LVL3:
  58               	.L3:
  59               	.LBB4:
 413:tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  60               		.loc 1 413 19 is_stmt 1 discriminator 3 view .LVU9
 413:tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  61               		.loc 1 413 33 discriminator 3 view .LVU10
 413:tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  62               		.loc 1 413 46 discriminator 3 view .LVU11
 413:tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  63               		.loc 1 413 48 discriminator 3 view .LVU12
  64 001c D0E0      		ldi r29,0
  65 001e 1C9F      		mul r17,r28
  66 0020 F001      		movw r30,r0
  67 0022 1D9F      		mul r17,r29
  68 0024 F00D      		add r31,r0
  69 0026 1124      		clr __zero_reg__
  70 0028 E050      		subi r30,lo8(-(waiting_buffer))
  71 002a F040      		sbci r31,hi8(-(waiting_buffer))
  72 002c 4081      		ld r20,Z
  73 002e 5181      		ldd r21,Z+1
  74 0030 6281      		ldd r22,Z+2
  75 0032 7381      		ldd r23,Z+3
  76 0034 8481      		ldd r24,Z+4
  77 0036 9581      		ldd r25,Z+5
  78 0038 0E94 0000 		call debug_record
  79               	.LVL4:
 413:tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  80               		.loc 1 413 91 discriminator 3 view .LVU13
 412:tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  81               		.loc 1 412 76 is_stmt 0 discriminator 3 view .LVU14
  82 003c 2196      		adiw r28,1
  83               	.LVL5:
 412:tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  84               		.loc 1 412 71 discriminator 3 view .LVU15
  85 003e C770      		andi r28,lo8(7)
 412:tmk_core/common/action_tapping.c ****         debug("["); debug_dec(i); debug("]="); debug_record(waiting_buffer[i]); debug(" ");
  86               		.loc 1 412 71 discriminator 3 view .LVU16
  87 0040 00C0      		rjmp .L2
  88               	.LBE4:
  89               		.cfi_endproc
  90               	.LFE13:
  92               		.section	.text.debug_tapping_key,"ax",@progbits
  94               	debug_tapping_key:
  95               	.LFB12:
 401:tmk_core/common/action_tapping.c ****     debug("TAPPING_KEY="); debug_record(tapping_key); debug("\n");
  96               		.loc 1 401 1 is_stmt 1 view -0
  97               		.cfi_startproc
  98               	/* prologue: function */
  99               	/* frame size = 0 */
 100               	/* stack size = 0 */
 101               	.L__stack_usage = 0
 402:tmk_core/common/action_tapping.c **** }
 102               		.loc 1 402 26 view .LVU18
 402:tmk_core/common/action_tapping.c **** }
 103               		.loc 1 402 28 view .LVU19
 104 0000 4091 0000 		lds r20,tapping_key
 105 0004 5091 0000 		lds r21,tapping_key+1
 106 0008 6091 0000 		lds r22,tapping_key+2
 107 000c 7091 0000 		lds r23,tapping_key+3
 108 0010 8091 0000 		lds r24,tapping_key+4
 109 0014 9091 0000 		lds r25,tapping_key+5
 110 0018 0C94 0000 		jmp debug_record
 111               	.LVL6:
 112               		.cfi_endproc
 113               	.LFE12:
 115               		.section	.text.waiting_buffer_typed.isra.1,"ax",@progbits
 117               	waiting_buffer_typed.isra.1:
 118               	.LFB15:
 346:tmk_core/common/action_tapping.c **** {
 119               		.loc 1 346 6 view -0
 120               		.cfi_startproc
 121               	/* prologue: function */
 122               	/* frame size = 0 */
 123               	/* stack size = 0 */
 124               	.L__stack_usage = 0
 348:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 125               		.loc 1 348 5 view .LVU21
 126               	.LBB5:
 348:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 127               		.loc 1 348 10 view .LVU22
 348:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 128               		.loc 1 348 18 is_stmt 0 view .LVU23
 129 0000 2091 0000 		lds r18,waiting_buffer_tail
 130               	.LVL7:
 348:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 131               		.loc 1 348 45 view .LVU24
 132 0004 9091 0000 		lds r25,waiting_buffer_head
 349:tmk_core/common/action_tapping.c ****             return true;
 133               		.loc 1 349 13 view .LVU25
 134 0008 56E0      		ldi r21,lo8(6)
 135               	.LVL8:
 136               	.L6:
 348:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 137               		.loc 1 348 5 view .LVU26
 138 000a 2913      		cpse r18,r25
 139 000c 00C0      		rjmp .L9
 140               	.LBE5:
 353:tmk_core/common/action_tapping.c **** }
 141               		.loc 1 353 12 view .LVU27
 142 000e 80E0      		ldi r24,0
 143 0010 0895      		ret
 144               	.L9:
 145               	.LBB6:
 349:tmk_core/common/action_tapping.c ****             return true;
 146               		.loc 1 349 9 is_stmt 1 view .LVU28
 349:tmk_core/common/action_tapping.c ****             return true;
 147               		.loc 1 349 13 is_stmt 0 view .LVU29
 148 0012 30E0      		ldi r19,0
 149 0014 529F      		mul r21,r18
 150 0016 F001      		movw r30,r0
 151 0018 539F      		mul r21,r19
 152 001a F00D      		add r31,r0
 153 001c 1124      		clr __zero_reg__
 154 001e E050      		subi r30,lo8(-(waiting_buffer))
 155 0020 F040      		sbci r31,hi8(-(waiting_buffer))
 349:tmk_core/common/action_tapping.c ****             return true;
 156               		.loc 1 349 12 view .LVU30
 157 0022 7181      		ldd r23,Z+1
 158 0024 7613      		cpse r23,r22
 159 0026 00C0      		rjmp .L7
 349:tmk_core/common/action_tapping.c ****             return true;
 160               		.loc 1 349 13 view .LVU31
 161 0028 7081      		ld r23,Z
 162 002a 7813      		cpse r23,r24
 163 002c 00C0      		rjmp .L7
 349:tmk_core/common/action_tapping.c ****             return true;
 164               		.loc 1 349 59 view .LVU32
 165 002e 7281      		ldd r23,Z+2
 166 0030 7413      		cpse r23,r20
 167 0032 00C0      		rjmp .L10
 168               	.L7:
 348:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 169               		.loc 1 348 76 view .LVU33
 170 0034 2F5F      		subi r18,-1
 171 0036 3F4F      		sbci r19,-1
 172               	.LVL9:
 348:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 173               		.loc 1 348 71 view .LVU34
 174 0038 2770      		andi r18,lo8(7)
 348:tmk_core/common/action_tapping.c ****         if (KEYEQ(event.key, waiting_buffer[i].event.key) && event.pressed !=  waiting_buffer[i].ev
 175               		.loc 1 348 71 view .LVU35
 176 003a 00C0      		rjmp .L6
 177               	.LVL10:
 178               	.L10:
 350:tmk_core/common/action_tapping.c ****         }
 179               		.loc 1 350 20 view .LVU36
 180 003c 81E0      		ldi r24,lo8(1)
 181               	/* epilogue start */
 182               	.LBE6:
 354:tmk_core/common/action_tapping.c **** 
 183               		.loc 1 354 1 view .LVU37
 184 003e 0895      		ret
 185               		.cfi_endproc
 186               	.LFE15:
 188               		.section	.text.waiting_buffer_scan_tap,"ax",@progbits
 190               	waiting_buffer_scan_tap:
 191               	.LFB11:
 374:tmk_core/common/action_tapping.c ****     // tapping already is settled
 192               		.loc 1 374 1 is_stmt 1 view -0
 193               		.cfi_startproc
 194 0000 1F93      		push r17
 195               	.LCFI3:
 196               		.cfi_def_cfa_offset 3
 197               		.cfi_offset 17, -2
 198 0002 CF93      		push r28
 199               	.LCFI4:
 200               		.cfi_def_cfa_offset 4
 201               		.cfi_offset 28, -3
 202 0004 DF93      		push r29
 203               	.LCFI5:
 204               		.cfi_def_cfa_offset 5
 205               		.cfi_offset 29, -4
 206               	/* prologue: function */
 207               	/* frame size = 0 */
 208               	/* stack size = 3 */
 209               	.L__stack_usage = 3
 376:tmk_core/common/action_tapping.c ****     // invalid state: tapping_key released && tap.count == 0
 210               		.loc 1 376 5 view .LVU39
 376:tmk_core/common/action_tapping.c ****     // invalid state: tapping_key released && tap.count == 0
 211               		.loc 1 376 31 is_stmt 0 view .LVU40
 212 0006 8091 0000 		lds r24,tapping_key+5
 213 000a 807F      		andi r24,lo8(-16)
 376:tmk_core/common/action_tapping.c ****     // invalid state: tapping_key released && tap.count == 0
 214               		.loc 1 376 8 view .LVU41
 215 000c 01F4      		brne .L11
 378:tmk_core/common/action_tapping.c **** 
 216               		.loc 1 378 5 is_stmt 1 view .LVU42
 378:tmk_core/common/action_tapping.c **** 
 217               		.loc 1 378 8 is_stmt 0 view .LVU43
 218 000e 8091 0000 		lds r24,tapping_key+2
 219 0012 8823      		tst r24
 220 0014 01F0      		breq .L11
 380:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 221               		.loc 1 380 5 is_stmt 1 view .LVU44
 222               	.LBB10:
 380:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 223               		.loc 1 380 10 view .LVU45
 380:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 224               		.loc 1 380 18 is_stmt 0 view .LVU46
 225 0016 8091 0000 		lds r24,waiting_buffer_tail
 226               	.LVL11:
 380:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 227               		.loc 1 380 45 view .LVU47
 228 001a C091 0000 		lds r28,waiting_buffer_head
 381:tmk_core/common/action_tapping.c ****                 !waiting_buffer[i].event.pressed &&
 229               		.loc 1 381 13 view .LVU48
 230 001e 6091 0000 		lds r22,tapping_key
 231 0022 7091 0000 		lds r23,tapping_key+1
 232 0026 4091 0000 		lds r20,tapping_key+3
 233 002a 5091 0000 		lds r21,tapping_key+3+1
 234 002e D62F      		mov r29,r22
 235 0030 D723      		and r29,r23
 236 0032 DA01      		movw r26,r20
 237 0034 A095      		com r26
 238 0036 B095      		com r27
 239 0038 16E0      		ldi r17,lo8(6)
 240               	.LVL12:
 241               	.L13:
 380:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 242               		.loc 1 380 5 discriminator 1 view .LVU49
 243 003a C813      		cpse r28,r24
 244 003c 00C0      		rjmp .L20
 245               	.LVL13:
 246               	.L11:
 247               	/* epilogue start */
 380:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 248               		.loc 1 380 5 discriminator 1 view .LVU50
 249               	.LBE10:
 393:tmk_core/common/action_tapping.c **** 
 250               		.loc 1 393 1 view .LVU51
 251 003e DF91      		pop r29
 252 0040 CF91      		pop r28
 253 0042 1F91      		pop r17
 254 0044 0895      		ret
 255               	.LVL14:
 256               	.L20:
 257               	.LBB13:
 381:tmk_core/common/action_tapping.c ****                 !waiting_buffer[i].event.pressed &&
 258               		.loc 1 381 9 is_stmt 1 view .LVU52
 259               	.LBB11:
 260               	.LBI11:
 261               		.file 2 "tmk_core/common/keyboard.h"
   1:tmk_core/common/keyboard.h **** /*
   2:tmk_core/common/keyboard.h **** Copyright 2011,2012,2013 Jun Wako <wakojun@gmail.com>
   3:tmk_core/common/keyboard.h **** 
   4:tmk_core/common/keyboard.h **** This program is free software: you can redistribute it and/or modify
   5:tmk_core/common/keyboard.h **** it under the terms of the GNU General Public License as published by
   6:tmk_core/common/keyboard.h **** the Free Software Foundation, either version 2 of the License, or
   7:tmk_core/common/keyboard.h **** (at your option) any later version.
   8:tmk_core/common/keyboard.h **** 
   9:tmk_core/common/keyboard.h **** This program is distributed in the hope that it will be useful,
  10:tmk_core/common/keyboard.h **** but WITHOUT ANY WARRANTY; without even the implied warranty of
  11:tmk_core/common/keyboard.h **** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  12:tmk_core/common/keyboard.h **** GNU General Public License for more details.
  13:tmk_core/common/keyboard.h **** 
  14:tmk_core/common/keyboard.h **** You should have received a copy of the GNU General Public License
  15:tmk_core/common/keyboard.h **** along with this program.  If not, see <http://www.gnu.org/licenses/>.
  16:tmk_core/common/keyboard.h **** */
  17:tmk_core/common/keyboard.h **** 
  18:tmk_core/common/keyboard.h **** #ifndef KEYBOARD_H
  19:tmk_core/common/keyboard.h **** #define KEYBOARD_H
  20:tmk_core/common/keyboard.h **** 
  21:tmk_core/common/keyboard.h **** #include <stdbool.h>
  22:tmk_core/common/keyboard.h **** #include <stdint.h>
  23:tmk_core/common/keyboard.h **** 
  24:tmk_core/common/keyboard.h **** 
  25:tmk_core/common/keyboard.h **** #ifdef __cplusplus
  26:tmk_core/common/keyboard.h **** extern "C" {
  27:tmk_core/common/keyboard.h **** #endif
  28:tmk_core/common/keyboard.h **** 
  29:tmk_core/common/keyboard.h **** /* key matrix position */
  30:tmk_core/common/keyboard.h **** typedef struct {
  31:tmk_core/common/keyboard.h ****     uint8_t col;
  32:tmk_core/common/keyboard.h ****     uint8_t row;
  33:tmk_core/common/keyboard.h **** } keypos_t;
  34:tmk_core/common/keyboard.h **** 
  35:tmk_core/common/keyboard.h **** /* key event */
  36:tmk_core/common/keyboard.h **** typedef struct {
  37:tmk_core/common/keyboard.h ****     keypos_t key;
  38:tmk_core/common/keyboard.h ****     bool     pressed;
  39:tmk_core/common/keyboard.h ****     uint16_t time;
  40:tmk_core/common/keyboard.h **** } keyevent_t;
  41:tmk_core/common/keyboard.h **** 
  42:tmk_core/common/keyboard.h **** /* equivalent test of keypos_t */
  43:tmk_core/common/keyboard.h **** #define KEYEQ(keya, keyb)       ((keya).row == (keyb).row && (keya).col == (keyb).col)
  44:tmk_core/common/keyboard.h **** 
  45:tmk_core/common/keyboard.h **** /* Rules for No Event:
  46:tmk_core/common/keyboard.h ****  * 1) (time == 0) to handle (keyevent_t){} as empty event
  47:tmk_core/common/keyboard.h ****  * 2) Matrix(255, 255) to make TICK event available
  48:tmk_core/common/keyboard.h ****  */
  49:tmk_core/common/keyboard.h **** static inline bool IS_NOEVENT(keyevent_t event) { return event.time == 0 || (event.key.row == 255 &
 262               		.loc 2 49 20 view .LVU53
 263               	.LBB12:
 264               		.loc 2 49 51 view .LVU54
 265 0046 90E0      		ldi r25,0
 266               		.loc 2 49 74 is_stmt 0 view .LVU55
 267 0048 4115      		cp r20,__zero_reg__
 268 004a 5105      		cpc r21,__zero_reg__
 269 004c 01F0      		breq .L14
 270 004e DF3F      		cpi r29,lo8(-1)
 271 0050 01F4      		brne .L33
 272               	.L14:
 273               	.LBE12:
 274               	.LBE11:
 380:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 275               		.loc 1 380 76 discriminator 2 view .LVU56
 276 0052 0196      		adiw r24,1
 277               	.LVL15:
 380:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 278               		.loc 1 380 71 discriminator 2 view .LVU57
 279 0054 8770      		andi r24,lo8(7)
 380:tmk_core/common/action_tapping.c ****         if (IS_TAPPING_KEY(waiting_buffer[i].event.key) &&
 280               		.loc 1 380 71 discriminator 2 view .LVU58
 281 0056 00C0      		rjmp .L13
 282               	.LVL16:
 283               	.L16:
 383:tmk_core/common/action_tapping.c ****             tapping_key.tap.count = 1;
 284               		.loc 1 383 17 discriminator 2 view .LVU59
 285 0058 2A0F      		add r18,r26
 286 005a 3B1F      		adc r19,r27
 287 005c 00C0      		rjmp .L34
 288               	.L33:
 381:tmk_core/common/action_tapping.c ****                 !waiting_buffer[i].event.pressed &&
 289               		.loc 1 381 13 view .LVU60
 290 005e 189F      		mul r17,r24
 291 0060 F001      		movw r30,r0
 292 0062 199F      		mul r17,r25
 293 0064 F00D      		add r31,r0
 294 0066 1124      		clr __zero_reg__
 295 0068 E050      		subi r30,lo8(-(waiting_buffer))
 296 006a F040      		sbci r31,hi8(-(waiting_buffer))
 297 006c 2181      		ldd r18,Z+1
 298 006e 2713      		cpse r18,r23
 299 0070 00C0      		rjmp .L14
 381:tmk_core/common/action_tapping.c ****                 !waiting_buffer[i].event.pressed &&
 300               		.loc 1 381 13 discriminator 2 view .LVU61
 301 0072 2081      		ld r18,Z
 302 0074 2613      		cpse r18,r22
 303 0076 00C0      		rjmp .L14
 381:tmk_core/common/action_tapping.c ****                 !waiting_buffer[i].event.pressed &&
 304               		.loc 1 381 57 discriminator 3 view .LVU62
 305 0078 2281      		ldd r18,Z+2
 306 007a 2111      		cpse r18,__zero_reg__
 307 007c 00C0      		rjmp .L14
 383:tmk_core/common/action_tapping.c ****             tapping_key.tap.count = 1;
 308               		.loc 1 383 17 view .LVU63
 309 007e 2381      		ldd r18,Z+3
 310 0080 3481      		ldd r19,Z+4
 311 0082 2417      		cp r18,r20
 312 0084 3507      		cpc r19,r21
 313 0086 00F0      		brlo .L16
 383:tmk_core/common/action_tapping.c ****             tapping_key.tap.count = 1;
 314               		.loc 1 383 17 discriminator 1 view .LVU64
 315 0088 241B      		sub r18,r20
 316 008a 350B      		sbc r19,r21
 317               	.L34:
 383:tmk_core/common/action_tapping.c ****             tapping_key.tap.count = 1;
 318               		.loc 1 383 17 discriminator 2 view .LVU65
 319 008c 2139      		cpi r18,-111
 320 008e 3105      		cpc r19,__zero_reg__
 321 0090 00F4      		brsh .L14
 384:tmk_core/common/action_tapping.c ****             waiting_buffer[i].tap.count = 1;
 322               		.loc 1 384 13 is_stmt 1 view .LVU66
 384:tmk_core/common/action_tapping.c ****             waiting_buffer[i].tap.count = 1;
 323               		.loc 1 384 35 is_stmt 0 view .LVU67
 324 0092 2091 0000 		lds r18,tapping_key+5
 325 0096 2F70      		andi r18,lo8(15)
 326 0098 2061      		ori r18,lo8(16)
 327 009a 2093 0000 		sts tapping_key+5,r18
 385:tmk_core/common/action_tapping.c ****             process_record(&tapping_key);
 328               		.loc 1 385 13 is_stmt 1 view .LVU68
 385:tmk_core/common/action_tapping.c ****             process_record(&tapping_key);
 329               		.loc 1 385 41 is_stmt 0 view .LVU69
 330 009e 26E0      		ldi r18,lo8(6)
 331 00a0 289F      		mul r18,r24
 332 00a2 F001      		movw r30,r0
 333 00a4 299F      		mul r18,r25
 334 00a6 F00D      		add r31,r0
 335 00a8 1124      		clr __zero_reg__
 336 00aa E050      		subi r30,lo8(-(waiting_buffer+5))
 337 00ac F040      		sbci r31,hi8(-(waiting_buffer+5))
 338 00ae 8081      		ld r24,Z
 339               	.LVL17:
 385:tmk_core/common/action_tapping.c ****             process_record(&tapping_key);
 340               		.loc 1 385 41 view .LVU70
 341 00b0 8F70      		andi r24,lo8(15)
 342 00b2 8061      		ori r24,lo8(16)
 343 00b4 8083      		st Z,r24
 386:tmk_core/common/action_tapping.c **** 
 344               		.loc 1 386 13 is_stmt 1 view .LVU71
 345 00b6 80E0      		ldi r24,lo8(tapping_key)
 346 00b8 90E0      		ldi r25,hi8(tapping_key)
 347 00ba 0E94 0000 		call process_record
 348               	.LVL18:
 388:tmk_core/common/action_tapping.c ****             debug_waiting_buffer();
 349               		.loc 1 388 57 view .LVU72
 388:tmk_core/common/action_tapping.c ****             debug_waiting_buffer();
 350               		.loc 1 388 71 view .LVU73
 388:tmk_core/common/action_tapping.c ****             debug_waiting_buffer();
 351               		.loc 1 388 85 view .LVU74
 389:tmk_core/common/action_tapping.c ****             return;
 352               		.loc 1 389 13 view .LVU75
 353               	/* epilogue start */
 354               	.LBE13:
 393:tmk_core/common/action_tapping.c **** 
 355               		.loc 1 393 1 is_stmt 0 view .LVU76
 356 00be DF91      		pop r29
 357 00c0 CF91      		pop r28
 358 00c2 1F91      		pop r17
 359               	.LBB14:
 389:tmk_core/common/action_tapping.c ****             return;
 360               		.loc 1 389 13 view .LVU77
 361 00c4 0C94 0000 		jmp debug_waiting_buffer
 362               	.LVL19:
 363               	.LBE14:
 364               		.cfi_endproc
 365               	.LFE11:
 367               		.section	.text.process_tapping,"ax",@progbits
 369               	process_tapping:
 370               	.LVL20:
 371               	.LFB6:
  93:tmk_core/common/action_tapping.c ****     keyevent_t event = keyp->event;
 372               		.loc 1 93 1 is_stmt 1 view -0
 373               		.cfi_startproc
  93:tmk_core/common/action_tapping.c ****     keyevent_t event = keyp->event;
 374               		.loc 1 93 1 is_stmt 0 view .LVU79
 375 0000 9F92      		push r9
 376               	.LCFI6:
 377               		.cfi_def_cfa_offset 3
 378               		.cfi_offset 9, -2
 379 0002 AF92      		push r10
 380               	.LCFI7:
 381               		.cfi_def_cfa_offset 4
 382               		.cfi_offset 10, -3
 383 0004 BF92      		push r11
 384               	.LCFI8:
 385               		.cfi_def_cfa_offset 5
 386               		.cfi_offset 11, -4
 387 0006 CF92      		push r12
 388               	.LCFI9:
 389               		.cfi_def_cfa_offset 6
 390               		.cfi_offset 12, -5
 391 0008 DF92      		push r13
 392               	.LCFI10:
 393               		.cfi_def_cfa_offset 7
 394               		.cfi_offset 13, -6
 395 000a EF92      		push r14
 396               	.LCFI11:
 397               		.cfi_def_cfa_offset 8
 398               		.cfi_offset 14, -7
 399 000c FF92      		push r15
 400               	.LCFI12:
 401               		.cfi_def_cfa_offset 9
 402               		.cfi_offset 15, -8
 403 000e 0F93      		push r16
 404               	.LCFI13:
 405               		.cfi_def_cfa_offset 10
 406               		.cfi_offset 16, -9
 407 0010 1F93      		push r17
 408               	.LCFI14:
 409               		.cfi_def_cfa_offset 11
 410               		.cfi_offset 17, -10
 411 0012 CF93      		push r28
 412               	.LCFI15:
 413               		.cfi_def_cfa_offset 12
 414               		.cfi_offset 28, -11
 415 0014 DF93      		push r29
 416               	.LCFI16:
 417               		.cfi_def_cfa_offset 13
 418               		.cfi_offset 29, -12
 419 0016 CDB7      		in r28,__SP_L__
 420 0018 DEB7      		in r29,__SP_H__
 421               	.LCFI17:
 422               		.cfi_def_cfa_register 28
 423 001a 6197      		sbiw r28,17
 424               	.LCFI18:
 425               		.cfi_def_cfa_offset 30
 426 001c 0FB6      		in __tmp_reg__,__SREG__
 427 001e F894      		cli
 428 0020 DEBF      		out __SP_H__,r29
 429 0022 0FBE      		out __SREG__,__tmp_reg__
 430 0024 CDBF      		out __SP_L__,r28
 431               	/* prologue: function */
 432               	/* frame size = 17 */
 433               	/* stack size = 28 */
 434               	.L__stack_usage = 28
 435 0026 8C01      		movw r16,r24
  94:tmk_core/common/action_tapping.c **** 
 436               		.loc 1 94 5 is_stmt 1 view .LVU80
  94:tmk_core/common/action_tapping.c **** 
 437               		.loc 1 94 16 is_stmt 0 view .LVU81
 438 0028 85E0      		ldi r24,lo8(5)
 439               	.LVL21:
  94:tmk_core/common/action_tapping.c **** 
 440               		.loc 1 94 16 view .LVU82
 441 002a F801      		movw r30,r16
 442 002c DE01      		movw r26,r28
 443 002e 1D96      		adiw r26,13
 444               		0:
 445 0030 0190      		ld r0,Z+
 446 0032 0D92      		st X+,r0
 447 0034 8A95      		dec r24
 448 0036 01F4      		brne 0b
 449 0038 D801      		movw r26,r16
 450 003a DC90      		ld r13,X
 451               	.LVL22:
  94:tmk_core/common/action_tapping.c **** 
 452               		.loc 1 94 16 view .LVU83
 453 003c 1196      		adiw r26,1
 454 003e EC90      		ld r14,X
 455 0040 1197      		sbiw r26,1
 456               	.LVL23:
  94:tmk_core/common/action_tapping.c **** 
 457               		.loc 1 94 16 view .LVU84
 458 0042 1296      		adiw r26,2
 459 0044 CC90      		ld r12,X
 460 0046 1297      		sbiw r26,2
 461               	.LVL24:
  97:tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 462               		.loc 1 97 5 is_stmt 1 view .LVU85
  97:tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 463               		.loc 1 97 9 is_stmt 0 view .LVU86
 464 0048 8091 0000 		lds r24,tapping_key+3
 465 004c 9091 0000 		lds r25,tapping_key+3+1
 466               	.LBB26:
 467               	.LBI26:
 468               		.loc 2 49 20 is_stmt 1 view .LVU87
 469               	.LBB27:
 470               		.loc 2 49 51 view .LVU88
 471               		.loc 2 49 74 is_stmt 0 view .LVU89
 472 0050 0097      		sbiw r24,0
 473 0052 01F4      		brne .+2
 474 0054 00C0      		rjmp .L36
 475               	.LBE27:
 476               	.LBE26:
  97:tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 477               		.loc 1 97 9 view .LVU90
 478 0056 2091 0000 		lds r18,tapping_key
 479 005a 3091 0000 		lds r19,tapping_key+1
 480               	.LBB29:
 481               	.LBB28:
 482               		.loc 2 49 74 view .LVU91
 483 005e 422F      		mov r20,r18
 484 0060 4323      		and r20,r19
 485 0062 4F3F      		cpi r20,lo8(-1)
 486 0064 01F4      		brne .+2
 487 0066 00C0      		rjmp .L36
 488               	.LBE28:
 489               	.LBE29:
  94:tmk_core/common/action_tapping.c **** 
 490               		.loc 1 94 16 discriminator 1 view .LVU92
 491 0068 1396      		adiw r26,3
 492 006a AD90      		ld r10,X+
 493 006c BC90      		ld r11,X
  97:tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 494               		.loc 1 97 9 discriminator 1 view .LVU93
 495 006e 9090 0000 		lds r9,tapping_key+2
 496 0072 9920      		tst r9
 497 0074 01F4      		brne .+2
 498 0076 00C0      		rjmp .L37
  98:tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 499               		.loc 1 98 9 is_stmt 1 view .LVU94
  98:tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 500               		.loc 1 98 13 is_stmt 0 view .LVU95
 501 0078 A816      		cp r10,r24
 502 007a B906      		cpc r11,r25
 503 007c 00F0      		brlo .L38
  98:tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 504               		.loc 1 98 13 discriminator 1 view .LVU96
 505 007e F501      		movw r30,r10
 506 0080 E81B      		sub r30,r24
 507 0082 F90B      		sbc r31,r25
 508 0084 CF01      		movw r24,r30
 509               	.L136:
  98:tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 510               		.loc 1 98 13 discriminator 2 view .LVU97
 511 0086 FF24      		clr r15
 512 0088 F394      		inc r15
 513 008a 8139      		cpi r24,-111
 514 008c 9105      		cpc r25,__zero_reg__
 515 008e 00F0      		brlo .L40
 516 0090 F12C      		mov r15,__zero_reg__
 517               	.L40:
 518 0092 8091 0000 		lds r24,tapping_key+5
 519 0096 982F      		mov r25,r24
 520 0098 907F      		andi r25,lo8(-16)
  98:tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 521               		.loc 1 98 12 discriminator 4 view .LVU98
 522 009a FF20      		tst r15
 523 009c 01F4      		brne .+2
 524 009e 00C0      		rjmp .L42
  99:tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
 525               		.loc 1 99 13 is_stmt 1 view .LVU99
  99:tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key) && !event.pressed) {
 526               		.loc 1 99 16 is_stmt 0 view .LVU100
 527 00a0 9111      		cpse r25,__zero_reg__
 528 00a2 00C0      		rjmp .L43
 100:tmk_core/common/action_tapping.c ****                     // first tap!
 529               		.loc 1 100 17 is_stmt 1 discriminator 1 view .LVU101
 530 00a4 FC2C      		mov r15,r12
 100:tmk_core/common/action_tapping.c ****                     // first tap!
 531               		.loc 1 100 21 is_stmt 0 discriminator 1 view .LVU102
 532 00a6 3E11      		cpse r19,r14
 533 00a8 00C0      		rjmp .L44
 100:tmk_core/common/action_tapping.c ****                     // first tap!
 534               		.loc 1 100 21 discriminator 2 view .LVU103
 535 00aa 2D11      		cpse r18,r13
 536 00ac 00C0      		rjmp .L44
 100:tmk_core/common/action_tapping.c ****                     // first tap!
 537               		.loc 1 100 47 discriminator 3 view .LVU104
 538 00ae C110      		cpse r12,__zero_reg__
 539 00b0 00C0      		rjmp .L44
 102:tmk_core/common/action_tapping.c ****                     tapping_key.tap.count = 1;
 540               		.loc 1 102 57 is_stmt 1 view .LVU105
 103:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 541               		.loc 1 103 21 view .LVU106
 103:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 542               		.loc 1 103 43 is_stmt 0 view .LVU107
 543 00b2 8F70      		andi r24,lo8(15)
 544 00b4 8061      		ori r24,lo8(16)
 545 00b6 8093 0000 		sts tapping_key+5,r24
 546               	.LVL25:
 104:tmk_core/common/action_tapping.c ****                     process_record(&tapping_key);
 547               		.loc 1 104 21 is_stmt 1 view .LVU108
 548 00ba 0E94 0000 		call debug_tapping_key
 549               	.LVL26:
 105:tmk_core/common/action_tapping.c **** 
 550               		.loc 1 105 21 view .LVU109
 551 00be 80E0      		ldi r24,lo8(tapping_key)
 552 00c0 90E0      		ldi r25,hi8(tapping_key)
 553 00c2 0E94 0000 		call process_record
 554               	.LVL27:
 108:tmk_core/common/action_tapping.c ****                     // enqueue
 555               		.loc 1 108 21 view .LVU110
 108:tmk_core/common/action_tapping.c ****                     // enqueue
 556               		.loc 1 108 31 is_stmt 0 view .LVU111
 557 00c6 8091 0000 		lds r24,tapping_key+5
 558 00ca D801      		movw r26,r16
 559 00cc 1596      		adiw r26,5
 560 00ce 8C93      		st X,r24
 110:tmk_core/common/action_tapping.c ****                 }
 561               		.loc 1 110 21 is_stmt 1 view .LVU112
 562               	.LVL28:
 563               	.L35:
 307:tmk_core/common/action_tapping.c **** 
 564               		.loc 1 307 1 is_stmt 0 view .LVU113
 565 00d0 8F2D      		mov r24,r15
 566               	/* epilogue start */
 307:tmk_core/common/action_tapping.c **** 
 567               		.loc 1 307 1 view .LVU114
 568 00d2 6196      		adiw r28,17
 569 00d4 0FB6      		in __tmp_reg__,__SREG__
 570 00d6 F894      		cli
 571 00d8 DEBF      		out __SP_H__,r29
 572 00da 0FBE      		out __SREG__,__tmp_reg__
 573 00dc CDBF      		out __SP_L__,r28
 574 00de DF91      		pop r29
 575 00e0 CF91      		pop r28
 576 00e2 1F91      		pop r17
 577 00e4 0F91      		pop r16
 578               	.LVL29:
 307:tmk_core/common/action_tapping.c **** 
 579               		.loc 1 307 1 view .LVU115
 580 00e6 FF90      		pop r15
 581 00e8 EF90      		pop r14
 307:tmk_core/common/action_tapping.c **** 
 582               		.loc 1 307 1 view .LVU116
 583 00ea DF90      		pop r13
 307:tmk_core/common/action_tapping.c **** 
 584               		.loc 1 307 1 view .LVU117
 585 00ec CF90      		pop r12
 307:tmk_core/common/action_tapping.c **** 
 586               		.loc 1 307 1 view .LVU118
 587 00ee BF90      		pop r11
 588 00f0 AF90      		pop r10
 589 00f2 9F90      		pop r9
 590 00f4 0895      		ret
 591               	.LVL30:
 592               	.L38:
  98:tmk_core/common/action_tapping.c ****             if (tapping_key.tap.count == 0) {
 593               		.loc 1 98 13 discriminator 2 view .LVU119
 594 00f6 8095      		com r24
 595 00f8 9095      		com r25
 596 00fa 8A0D      		add r24,r10
 597 00fc 9B1D      		adc r25,r11
 598 00fe 00C0      		rjmp .L136
 599               	.L44:
 120:tmk_core/common/action_tapping.c **** #endif
 600               		.loc 1 120 22 is_stmt 1 view .LVU120
 601               	.LVL31:
 602               	.LBB30:
 603               	.LBI30:
  50:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
  51:tmk_core/common/keyboard.h **** static inline bool IS_RELEASED(keyevent_t event) { return (!IS_NOEVENT(event) && !event.pressed); }
 604               		.loc 2 51 20 view .LVU121
 605               	.LBB31:
 606               		.loc 2 51 52 view .LVU122
 607               	.LBB32:
 608               	.LBI32:
  49:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 609               		.loc 2 49 20 view .LVU123
 610               	.LBB33:
  49:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 611               		.loc 2 49 51 view .LVU124
  49:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 612               		.loc 2 49 74 is_stmt 0 view .LVU125
 613 0100 A114      		cp r10,__zero_reg__
 614 0102 B104      		cpc r11,__zero_reg__
 615 0104 01F0      		breq .L74
 616 0106 8E2D      		mov r24,r14
 617 0108 8D21      		and r24,r13
 618 010a 8F3F      		cpi r24,lo8(-1)
 619 010c 01F0      		breq .+2
 620 010e 00C0      		rjmp .L47
 621               	.L74:
  49:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 622               		.loc 2 49 74 view .LVU126
 623               	.LBE33:
 624               	.LBE32:
 625               		.loc 2 51 79 view .LVU127
 626 0110 80E0      		ldi r24,0
 627               	.L46:
 628               	.LVL32:
 629               		.loc 2 51 79 view .LVU128
 630               	.LBE31:
 631               	.LBE30:
 120:tmk_core/common/action_tapping.c **** #endif
 632               		.loc 1 120 25 view .LVU129
 633 0112 80FF      		sbrs r24,0
 634 0114 00C0      		rjmp .L48
 120:tmk_core/common/action_tapping.c **** #endif
 635               		.loc 1 120 49 discriminator 1 view .LVU130
 636 0116 4C2D      		mov r20,r12
 637 0118 6E2D      		mov r22,r14
 638 011a 8D2D      		mov r24,r13
 639 011c 0E94 0000 		call waiting_buffer_typed.isra.1
 640               	.LVL33:
 120:tmk_core/common/action_tapping.c **** #endif
 641               		.loc 1 120 46 discriminator 1 view .LVU131
 642 0120 8823      		tst r24
 643 0122 01F0      		breq .L48
 123:tmk_core/common/action_tapping.c ****                     process_record(&tapping_key);
 644               		.loc 1 123 78 is_stmt 1 view .LVU132
 124:tmk_core/common/action_tapping.c ****                     tapping_key = (keyrecord_t){};
 645               		.loc 1 124 21 view .LVU133
 646 0124 80E0      		ldi r24,lo8(tapping_key)
 647 0126 90E0      		ldi r25,hi8(tapping_key)
 648 0128 0E94 0000 		call process_record
 649               	.LVL34:
 125:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 650               		.loc 1 125 21 view .LVU134
 125:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 651               		.loc 1 125 33 is_stmt 0 view .LVU135
 652 012c 86E0      		ldi r24,lo8(6)
 653 012e E0E0      		ldi r30,lo8(tapping_key)
 654 0130 F0E0      		ldi r31,hi8(tapping_key)
 655 0132 DF01      		movw r26,r30
 656               		0:
 657 0134 1D92      		st X+,__zero_reg__
 658 0136 8A95      		dec r24
 659 0138 01F4      		brne 0b
 126:tmk_core/common/action_tapping.c ****                     // enqueue
 660               		.loc 1 126 21 is_stmt 1 view .LVU136
 661 013a 0E94 0000 		call debug_tapping_key
 662               	.LVL35:
 128:tmk_core/common/action_tapping.c ****                 }
 663               		.loc 1 128 21 view .LVU137
 664               	.L141:
 161:tmk_core/common/action_tapping.c ****                 }
 665               		.loc 1 161 28 is_stmt 0 view .LVU138
 666 013e F12C      		mov r15,__zero_reg__
 667 0140 00C0      		rjmp .L35
 668               	.LVL36:
 669               	.L48:
 135:tmk_core/common/action_tapping.c ****                     // Modifier should be retained till end of this tapping.
 670               		.loc 1 135 22 is_stmt 1 view .LVU139
 671               	.LBB35:
 672               	.LBI35:
 673               		.loc 2 51 20 view .LVU140
 674               	.LBB36:
 675               		.loc 2 51 52 view .LVU141
 676               	.LBB37:
 677               	.LBI37:
  49:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 678               		.loc 2 49 20 view .LVU142
 679               	.LBB38:
  49:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 680               		.loc 2 49 51 view .LVU143
  49:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 681               		.loc 2 49 74 is_stmt 0 view .LVU144
 682 0142 AB28      		or r10,r11
 683 0144 01F0      		breq .L75
  49:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 684               		.loc 2 49 74 view .LVU145
 685 0146 8E2D      		mov r24,r14
 686 0148 8D21      		and r24,r13
 687 014a 8F3F      		cpi r24,lo8(-1)
 688 014c 01F0      		breq .+2
 689 014e 00C0      		rjmp .L50
 690               	.L75:
  49:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 691               		.loc 2 49 74 view .LVU146
 692               	.LBE38:
 693               	.LBE37:
 694               		.loc 2 51 79 view .LVU147
 695 0150 80E0      		ldi r24,0
 696               	.L49:
 697               	.LVL37:
 698               		.loc 2 51 79 view .LVU148
 699               	.LBE36:
 700               	.LBE35:
 135:tmk_core/common/action_tapping.c ****                     // Modifier should be retained till end of this tapping.
 701               		.loc 1 135 25 view .LVU149
 702 0152 B82F      		mov r27,r24
 703 0154 B170      		andi r27,lo8(1)
 704 0156 AB2E      		mov r10,r27
 705               	.LVL38:
 135:tmk_core/common/action_tapping.c ****                     // Modifier should be retained till end of this tapping.
 706               		.loc 1 135 25 view .LVU150
 707 0158 80FF      		sbrs r24,0
 708 015a 00C0      		rjmp .L51
 135:tmk_core/common/action_tapping.c ****                     // Modifier should be retained till end of this tapping.
 709               		.loc 1 135 49 discriminator 1 view .LVU151
 710 015c 4C2D      		mov r20,r12
 711 015e 6E2D      		mov r22,r14
 712 0160 8D2D      		mov r24,r13
 713 0162 0E94 0000 		call waiting_buffer_typed.isra.1
 714               	.LVL39:
 715 0166 B82E      		mov r11,r24
 135:tmk_core/common/action_tapping.c ****                     // Modifier should be retained till end of this tapping.
 716               		.loc 1 135 45 discriminator 1 view .LVU152
 717 0168 8111      		cpse r24,__zero_reg__
 718 016a 00C0      		rjmp .L51
 719               	.LBB40:
 137:tmk_core/common/action_tapping.c ****                     switch (action.kind.id) {
 720               		.loc 1 137 21 is_stmt 1 view .LVU153
 137:tmk_core/common/action_tapping.c ****                     switch (action.kind.id) {
 721               		.loc 1 137 39 is_stmt 0 view .LVU154
 722 016c DD86      		std Y+13,r13
 723 016e EE86      		std Y+14,r14
 724 0170 8D85      		ldd r24,Y+13
 725 0172 9E85      		ldd r25,Y+14
 726 0174 0E94 0000 		call layer_switch_get_action
 727               	.LVL40:
 138:tmk_core/common/action_tapping.c ****                         case ACT_LMODS:
 728               		.loc 1 138 21 is_stmt 1 view .LVU155
 138:tmk_core/common/action_tapping.c ****                         case ACT_LMODS:
 729               		.loc 1 138 40 is_stmt 0 view .LVU156
 730 0178 292F      		mov r18,r25
 731 017a 2295      		swap r18
 732 017c 2F70      		andi r18,lo8(15)
 733 017e 2230      		cpi r18,lo8(2)
 734 0180 00F0      		brlo .L52
 138:tmk_core/common/action_tapping.c ****                         case ACT_LMODS:
 735               		.loc 1 138 40 view .LVU157
 736 0182 2430      		cpi r18,lo8(4)
 737 0184 00F4      		brsh .L53
 146:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 738               		.loc 1 146 29 is_stmt 1 view .LVU158
 146:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 739               		.loc 1 146 33 is_stmt 0 view .LVU159
 740 0186 9F70      		andi r25,lo8(15)
 741               	.LVL41:
 146:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 742               		.loc 1 146 32 view .LVU160
 743 0188 01F0      		breq .L57
 146:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 744               		.loc 1 146 68 discriminator 1 view .LVU161
 745 018a F801      		movw r30,r16
 746 018c 9581      		ldd r25,Z+5
 747 018e 907F      		andi r25,lo8(-16)
 146:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 748               		.loc 1 146 49 discriminator 1 view .LVU162
 749 0190 01F4      		brne .L57
 750               	.LVL42:
 751               	.L56:
 146:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 752               		.loc 1 146 49 discriminator 1 view .LVU163
 753 0192 FB2C      		mov r15,r11
 754 0194 00C0      		rjmp .L35
 755               	.LVL43:
 756               	.L52:
 141:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 757               		.loc 1 141 29 is_stmt 1 view .LVU164
 141:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 758               		.loc 1 141 33 is_stmt 0 view .LVU165
 759 0196 9F70      		andi r25,lo8(15)
 760               	.LVL44:
 141:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 761               		.loc 1 141 32 view .LVU166
 762 0198 01F0      		breq .L57
 141:tmk_core/common/action_tapping.c ****                             if (IS_MOD(action.key.code)) return false;
 763               		.loc 1 141 49 discriminator 1 view .LVU167
 764 019a 8823      		tst r24
 765 019c 01F0      		breq .L56
 766               	.L57:
 147:tmk_core/common/action_tapping.c ****                             break;
 767               		.loc 1 147 29 is_stmt 1 view .LVU168
 147:tmk_core/common/action_tapping.c ****                             break;
 768               		.loc 1 147 33 is_stmt 0 view .LVU169
 769 019e 805E      		subi r24,lo8(-(32))
 770               	.LVL45:
 147:tmk_core/common/action_tapping.c ****                             break;
 771               		.loc 1 147 32 view .LVU170
 772 01a0 8830      		cpi r24,lo8(8)
 773 01a2 00F0      		brlo .L56
 774               	.LVL46:
 775               	.L53:
 151:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 776               		.loc 1 151 86 is_stmt 1 view .LVU171
 152:tmk_core/common/action_tapping.c ****                     return true;
 777               		.loc 1 152 21 view .LVU172
 778 01a4 C801      		movw r24,r16
 779               	.LVL47:
 152:tmk_core/common/action_tapping.c ****                     return true;
 780               		.loc 1 152 21 is_stmt 0 view .LVU173
 781 01a6 0E94 0000 		call process_record
 782               	.LVL48:
 153:tmk_core/common/action_tapping.c ****                 }
 783               		.loc 1 153 21 is_stmt 1 view .LVU174
 153:tmk_core/common/action_tapping.c ****                 }
 784               		.loc 1 153 28 is_stmt 0 view .LVU175
 785 01aa BA2C      		mov r11,r10
 786 01ac 00C0      		rjmp .L56
 787               	.LVL49:
 788               	.L51:
 153:tmk_core/common/action_tapping.c ****                 }
 789               		.loc 1 153 28 view .LVU176
 790               	.LBE40:
 157:tmk_core/common/action_tapping.c ****                         tapping_key.tap.interrupted = true;
 791               		.loc 1 157 21 is_stmt 1 view .LVU177
 157:tmk_core/common/action_tapping.c ****                         tapping_key.tap.interrupted = true;
 792               		.loc 1 157 24 is_stmt 0 view .LVU178
 793 01ae CC20      		tst r12
 794 01b0 01F4      		brne .+2
 795 01b2 00C0      		rjmp .L35
 158:tmk_core/common/action_tapping.c ****                     }
 796               		.loc 1 158 25 is_stmt 1 view .LVU179
 158:tmk_core/common/action_tapping.c ****                     }
 797               		.loc 1 158 53 is_stmt 0 view .LVU180
 798 01b4 8091 0000 		lds r24,tapping_key+5
 799 01b8 8160      		ori r24,lo8(1<<0)
 800 01ba 8093 0000 		sts tapping_key+5,r24
 801 01be 00C0      		rjmp .L141
 802               	.LVL50:
 803               	.L43:
 166:tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release("); debug_dec(tapping_key.tap.count); debug(")\n");
 804               		.loc 1 166 17 is_stmt 1 discriminator 1 view .LVU181
 166:tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release("); debug_dec(tapping_key.tap.count); debug(")\n");
 805               		.loc 1 166 21 is_stmt 0 discriminator 1 view .LVU182
 806 01c0 3E11      		cpse r19,r14
 807 01c2 00C0      		rjmp .L58
 166:tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release("); debug_dec(tapping_key.tap.count); debug(")\n");
 808               		.loc 1 166 21 discriminator 2 view .LVU183
 809 01c4 2D11      		cpse r18,r13
 810 01c6 00C0      		rjmp .L58
 168:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 811               		.loc 1 168 31 discriminator 3 view .LVU184
 812 01c8 D801      		movw r26,r16
 166:tmk_core/common/action_tapping.c ****                     debug("Tapping: Tap release("); debug_dec(tapping_key.tap.count); debug(")\n");
 813               		.loc 1 166 47 discriminator 3 view .LVU185
 814 01ca CC20      		tst r12
 815 01cc 01F4      		brne .+2
 816 01ce 00C0      		rjmp .L145
 817               	.L58:
 174:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 818               		.loc 1 174 22 is_stmt 1 view .LVU186
 174:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 819               		.loc 1 174 26 is_stmt 0 view .LVU187
 820 01d0 DD86      		std Y+13,r13
 821 01d2 EE86      		std Y+14,r14
 822 01d4 8D85      		ldd r24,Y+13
 823 01d6 9E85      		ldd r25,Y+14
 824 01d8 0E94 0000 		call is_tap_key
 825               	.LVL51:
 174:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 826               		.loc 1 174 25 view .LVU188
 827 01dc 8823      		tst r24
 828 01de 01F0      		breq .L70
 174:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 829               		.loc 1 174 48 discriminator 1 view .LVU189
 830 01e0 CC20      		tst r12
 831 01e2 01F0      		breq .L70
 175:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last tap(>1).\n");
 832               		.loc 1 175 21 is_stmt 1 view .LVU190
 175:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last tap(>1).\n");
 833               		.loc 1 175 40 is_stmt 0 view .LVU191
 834 01e4 8091 0000 		lds r24,tapping_key+5
 175:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last tap(>1).\n");
 835               		.loc 1 175 24 view .LVU192
 836 01e8 8032      		cpi r24,lo8(32)
 837 01ea 00F0      		brlo .L61
 176:tmk_core/common/action_tapping.c ****                         // unregister key
 838               		.loc 1 176 87 is_stmt 1 view .LVU193
 178:tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 839               		.loc 1 178 25 view .LVU194
 178:tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 840               		.loc 1 178 54 is_stmt 0 view .LVU195
 841 01ec 2091 0000 		lds r18,tapping_key
 842 01f0 3091 0000 		lds r19,tapping_key+1
 843 01f4 3887      		std Y+8,r19
 844 01f6 2F83      		std Y+7,r18
 845 01f8 1986      		std Y+9,__zero_reg__
 846 01fa BB86      		std Y+11,r11
 847 01fc AA86      		std Y+10,r10
 848 01fe 8C87      		std Y+12,r24
 178:tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 849               		.loc 1 178 25 view .LVU196
 850 0200 CE01      		movw r24,r28
 851 0202 0796      		adiw r24,7
 852               	.L138:
 178:tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 853               		.loc 1 178 25 view .LVU197
 854 0204 0E94 0000 		call process_record
 855               	.LVL52:
 856               	.L61:
 185:tmk_core/common/action_tapping.c ****                     }
 857               		.loc 1 185 69 is_stmt 1 view .LVU198
 187:tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 858               		.loc 1 187 21 view .LVU199
 187:tmk_core/common/action_tapping.c ****                     waiting_buffer_scan_tap();
 859               		.loc 1 187 33 is_stmt 0 view .LVU200
 860 0208 86E0      		ldi r24,lo8(6)
 861 020a F801      		movw r30,r16
 862 020c A0E0      		ldi r26,lo8(tapping_key)
 863 020e B0E0      		ldi r27,hi8(tapping_key)
 864               		0:
 865 0210 0190      		ld r0,Z+
 866 0212 0D92      		st X+,r0
 867 0214 8A95      		dec r24
 868 0216 01F4      		brne 0b
 188:tmk_core/common/action_tapping.c ****                     debug_tapping_key();
 869               		.loc 1 188 21 is_stmt 1 view .LVU201
 870 0218 0E94 0000 		call waiting_buffer_scan_tap
 871               	.LVL53:
 189:tmk_core/common/action_tapping.c ****                     return true;
 872               		.loc 1 189 21 view .LVU202
 873 021c 0E94 0000 		call debug_tapping_key
 874               	.LVL54:
 190:tmk_core/common/action_tapping.c ****                 }
 875               		.loc 1 190 21 view .LVU203
 876               	.L142:
 197:tmk_core/common/action_tapping.c ****                 }
 877               		.loc 1 197 21 view .LVU204
 197:tmk_core/common/action_tapping.c ****                 }
 878               		.loc 1 197 28 is_stmt 0 view .LVU205
 879 0220 FF24      		clr r15
 880 0222 F394      		inc r15
 881 0224 00C0      		rjmp .L35
 882               	.L70:
 193:tmk_core/common/action_tapping.c ****                         debug("Tapping: key event while last tap(>0).\n");
 883               		.loc 1 193 21 is_stmt 1 view .LVU206
 194:tmk_core/common/action_tapping.c ****                     }
 884               		.loc 1 194 74 view .LVU207
 196:tmk_core/common/action_tapping.c ****                     return true;
 885               		.loc 1 196 21 view .LVU208
 886 0226 C801      		movw r24,r16
 887 0228 0E94 0000 		call process_record
 888               	.LVL55:
 889 022c 00C0      		rjmp .L142
 890               	.LVL56:
 891               	.L42:
 203:tmk_core/common/action_tapping.c ****                 debug("Tapping: End. Timeout. Not tap(0): ");
 892               		.loc 1 203 13 view .LVU209
 203:tmk_core/common/action_tapping.c ****                 debug("Tapping: End. Timeout. Not tap(0): ");
 893               		.loc 1 203 16 is_stmt 0 view .LVU210
 894 022e 9111      		cpse r25,__zero_reg__
 895 0230 00C0      		rjmp .L62
 204:tmk_core/common/action_tapping.c ****                 debug_event(event); debug("\n");
 896               		.loc 1 204 61 is_stmt 1 view .LVU211
 205:tmk_core/common/action_tapping.c ****                 process_record(&tapping_key);
 897               		.loc 1 205 17 view .LVU212
 205:tmk_core/common/action_tapping.c ****                 process_record(&tapping_key);
 898               		.loc 1 205 17 is_stmt 0 view .LVU213
 899 0232 7A2D      		mov r23,r10
 900 0234 B98A      		std Y+17,r11
 901 0236 A88A      		std Y+16,r10
 902 0238 4D2D      		mov r20,r13
 903 023a 5E2D      		mov r21,r14
 904 023c 6C2D      		mov r22,r12
 905 023e 8989      		ldd r24,Y+17
 906 0240 0E94 0000 		call debug_event
 907               	.LVL57:
 205:tmk_core/common/action_tapping.c ****                 process_record(&tapping_key);
 908               		.loc 1 205 48 is_stmt 1 view .LVU214
 206:tmk_core/common/action_tapping.c ****                 tapping_key = (keyrecord_t){};
 909               		.loc 1 206 17 view .LVU215
 910 0244 80E0      		ldi r24,lo8(tapping_key)
 911 0246 90E0      		ldi r25,hi8(tapping_key)
 912 0248 0E94 0000 		call process_record
 913               	.LVL58:
 207:tmk_core/common/action_tapping.c ****                 debug_tapping_key();
 914               		.loc 1 207 17 view .LVU216
 915               	.L146:
 287:tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
 916               		.loc 1 287 44 view .LVU217
 288:tmk_core/common/action_tapping.c ****             debug_tapping_key();
 917               		.loc 1 288 13 view .LVU218
 288:tmk_core/common/action_tapping.c ****             debug_tapping_key();
 918               		.loc 1 288 25 is_stmt 0 view .LVU219
 919 024c 86E0      		ldi r24,lo8(6)
 920 024e E0E0      		ldi r30,lo8(tapping_key)
 921 0250 F0E0      		ldi r31,hi8(tapping_key)
 922 0252 DF01      		movw r26,r30
 923               		0:
 924 0254 1D92      		st X+,__zero_reg__
 925 0256 8A95      		dec r24
 926 0258 01F4      		brne 0b
 289:tmk_core/common/action_tapping.c ****             return false;
 927               		.loc 1 289 13 is_stmt 1 view .LVU220
 928 025a 00C0      		rjmp .L140
 929               	.L62:
 211:tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 930               		.loc 1 211 17 discriminator 1 view .LVU221
 211:tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 931               		.loc 1 211 21 is_stmt 0 discriminator 1 view .LVU222
 932 025c 3E11      		cpse r19,r14
 933 025e 00C0      		rjmp .L63
 211:tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 934               		.loc 1 211 21 discriminator 2 view .LVU223
 935 0260 2D11      		cpse r18,r13
 936 0262 00C0      		rjmp .L63
 211:tmk_core/common/action_tapping.c ****                     debug("Tapping: End. last timeout tap release(>0).");
 937               		.loc 1 211 47 discriminator 3 view .LVU224
 938 0264 C110      		cpse r12,__zero_reg__
 939 0266 00C0      		rjmp .L63
 212:tmk_core/common/action_tapping.c ****                     keyp->tap = tapping_key.tap;
 940               		.loc 1 212 73 is_stmt 1 view .LVU225
 213:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 941               		.loc 1 213 21 view .LVU226
 213:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 942               		.loc 1 213 31 is_stmt 0 view .LVU227
 943 0268 F801      		movw r30,r16
 944 026a 8583      		std Z+5,r24
 214:tmk_core/common/action_tapping.c ****                     tapping_key = (keyrecord_t){};
 945               		.loc 1 214 21 is_stmt 1 view .LVU228
 946 026c C801      		movw r24,r16
 947 026e 0E94 0000 		call process_record
 948               	.LVL59:
 215:tmk_core/common/action_tapping.c ****                     return true;
 949               		.loc 1 215 21 view .LVU229
 215:tmk_core/common/action_tapping.c ****                     return true;
 950               		.loc 1 215 33 is_stmt 0 view .LVU230
 951 0272 E0E0      		ldi r30,lo8(tapping_key)
 952 0274 F0E0      		ldi r31,hi8(tapping_key)
 953 0276 86E0      		ldi r24,lo8(6)
 954 0278 DF01      		movw r26,r30
 955               		0:
 956 027a 1D92      		st X+,__zero_reg__
 957 027c 8A95      		dec r24
 958 027e 01F4      		brne 0b
 216:tmk_core/common/action_tapping.c ****                 }
 959               		.loc 1 216 21 is_stmt 1 view .LVU231
 216:tmk_core/common/action_tapping.c ****                 }
 960               		.loc 1 216 28 is_stmt 0 view .LVU232
 961 0280 F92C      		mov r15,r9
 962 0282 00C0      		rjmp .L35
 963               	.L63:
 218:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 964               		.loc 1 218 22 is_stmt 1 view .LVU233
 218:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 965               		.loc 1 218 26 is_stmt 0 view .LVU234
 966 0284 DD86      		std Y+13,r13
 967 0286 EE86      		std Y+14,r14
 968 0288 8D85      		ldd r24,Y+13
 969 028a 9E85      		ldd r25,Y+14
 970 028c 0E94 0000 		call is_tap_key
 971               	.LVL60:
 218:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 972               		.loc 1 218 25 view .LVU235
 973 0290 8823      		tst r24
 974 0292 01F0      		breq .L70
 218:tmk_core/common/action_tapping.c ****                     if (tapping_key.tap.count > 1) {
 975               		.loc 1 218 48 discriminator 1 view .LVU236
 976 0294 CC20      		tst r12
 977 0296 01F0      		breq .L70
 219:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last timeout tap(>1).\n");
 978               		.loc 1 219 21 is_stmt 1 view .LVU237
 219:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last timeout tap(>1).\n");
 979               		.loc 1 219 40 is_stmt 0 view .LVU238
 980 0298 8091 0000 		lds r24,tapping_key+5
 219:tmk_core/common/action_tapping.c ****                         debug("Tapping: Start new tap with releasing last timeout tap(>1).\n");
 981               		.loc 1 219 24 view .LVU239
 982 029c 8032      		cpi r24,lo8(32)
 983 029e 00F4      		brsh .+2
 984 02a0 00C0      		rjmp .L61
 220:tmk_core/common/action_tapping.c ****                         // unregister key
 985               		.loc 1 220 95 is_stmt 1 view .LVU240
 222:tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 986               		.loc 1 222 25 view .LVU241
 222:tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 987               		.loc 1 222 54 is_stmt 0 view .LVU242
 988 02a2 2091 0000 		lds r18,tapping_key
 989 02a6 3091 0000 		lds r19,tapping_key+1
 990 02aa 3A83      		std Y+2,r19
 991 02ac 2983      		std Y+1,r18
 992 02ae 1B82      		std Y+3,__zero_reg__
 993 02b0 BD82      		std Y+5,r11
 994 02b2 AC82      		std Y+4,r10
 995 02b4 8E83      		std Y+6,r24
 222:tmk_core/common/action_tapping.c ****                                 .tap = tapping_key.tap,
 996               		.loc 1 222 25 view .LVU243
 997 02b6 CE01      		movw r24,r28
 998 02b8 0196      		adiw r24,1
 999 02ba 00C0      		rjmp .L138
 1000               	.L37:
 245:tmk_core/common/action_tapping.c ****         if (WITHIN_TAPPING_TERM(event)) {
 1001               		.loc 1 245 12 is_stmt 1 discriminator 1 view .LVU244
 246:tmk_core/common/action_tapping.c ****             if (event.pressed) {
 1002               		.loc 1 246 9 discriminator 1 view .LVU245
 246:tmk_core/common/action_tapping.c ****             if (event.pressed) {
 1003               		.loc 1 246 13 is_stmt 0 discriminator 1 view .LVU246
 1004 02bc A816      		cp r10,r24
 1005 02be B906      		cpc r11,r25
 1006 02c0 00F0      		brlo .L65
 1007 02c2 F501      		movw r30,r10
 1008 02c4 E81B      		sub r30,r24
 1009 02c6 F90B      		sbc r31,r25
 1010 02c8 CF01      		movw r24,r30
 1011               	.L144:
 246:tmk_core/common/action_tapping.c ****             if (event.pressed) {
 1012               		.loc 1 246 13 discriminator 2 view .LVU247
 1013 02ca F12C      		mov r15,__zero_reg__
 1014 02cc 8139      		cpi r24,-111
 1015 02ce 9105      		cpc r25,__zero_reg__
 1016 02d0 00F0      		brlo .+2
 1017 02d2 00C0      		rjmp .L69
 247:tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key)) {
 1018               		.loc 1 247 13 is_stmt 1 view .LVU248
 247:tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key)) {
 1019               		.loc 1 247 22 is_stmt 0 view .LVU249
 1020 02d4 FC2C      		mov r15,r12
 247:tmk_core/common/action_tapping.c ****                 if (IS_TAPPING_KEY(event.key)) {
 1021               		.loc 1 247 16 view .LVU250
 1022 02d6 CC20      		tst r12
 1023 02d8 01F4      		brne .+2
 1024 02da 00C0      		rjmp .L70
 248:tmk_core/common/action_tapping.c **** #ifndef TAPPING_FORCE_HOLD
 1025               		.loc 1 248 17 is_stmt 1 discriminator 1 view .LVU251
 248:tmk_core/common/action_tapping.c **** #ifndef TAPPING_FORCE_HOLD
 1026               		.loc 1 248 21 is_stmt 0 discriminator 1 view .LVU252
 1027 02dc 3E11      		cpse r19,r14
 1028 02de 00C0      		rjmp .L71
 248:tmk_core/common/action_tapping.c **** #ifndef TAPPING_FORCE_HOLD
 1029               		.loc 1 248 21 discriminator 2 view .LVU253
 1030 02e0 2D11      		cpse r18,r13
 1031 02e2 00C0      		rjmp .L71
 250:tmk_core/common/action_tapping.c ****                         // sequential tap.
 1032               		.loc 1 250 21 is_stmt 1 view .LVU254
 250:tmk_core/common/action_tapping.c ****                         // sequential tap.
 1033               		.loc 1 250 41 is_stmt 0 view .LVU255
 1034 02e4 8091 0000 		lds r24,tapping_key+5
 250:tmk_core/common/action_tapping.c ****                         // sequential tap.
 1035               		.loc 1 250 24 view .LVU256
 1036 02e8 80FD      		sbrc r24,0
 1037 02ea 00C0      		rjmp .L72
 250:tmk_core/common/action_tapping.c ****                         // sequential tap.
 1038               		.loc 1 250 79 discriminator 1 view .LVU257
 1039 02ec 982F      		mov r25,r24
 1040 02ee 907F      		andi r25,lo8(-16)
 250:tmk_core/common/action_tapping.c ****                         // sequential tap.
 1041               		.loc 1 250 54 discriminator 1 view .LVU258
 1042 02f0 01F0      		breq .L72
 252:tmk_core/common/action_tapping.c ****                         if (keyp->tap.count < 15) keyp->tap.count += 1;
 1043               		.loc 1 252 25 is_stmt 1 view .LVU259
 252:tmk_core/common/action_tapping.c ****                         if (keyp->tap.count < 15) keyp->tap.count += 1;
 1044               		.loc 1 252 35 is_stmt 0 view .LVU260
 1045 02f2 D801      		movw r26,r16
 1046 02f4 1596      		adiw r26,5
 1047 02f6 8C93      		st X,r24
 1048 02f8 1597      		sbiw r26,5
 253:tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press("); debug_dec(keyp->tap.count); debug(")\n");
 1049               		.loc 1 253 25 is_stmt 1 view .LVU261
 253:tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press("); debug_dec(keyp->tap.count); debug(")\n");
 1050               		.loc 1 253 28 is_stmt 0 view .LVU262
 1051 02fa 903F      		cpi r25,lo8(-16)
 1052 02fc 01F0      		breq .L73
 253:tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press("); debug_dec(keyp->tap.count); debug(")\n");
 1053               		.loc 1 253 51 is_stmt 1 discriminator 1 view .LVU263
 253:tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press("); debug_dec(keyp->tap.count); debug(")\n");
 1054               		.loc 1 253 67 is_stmt 0 discriminator 1 view .LVU264
 1055 02fe 982F      		mov r25,r24
 1056 0300 907F      		andi r25,lo8(-16)
 1057 0302 905F      		subi r25,lo8(-(16))
 1058 0304 8F70      		andi r24,lo8(15)
 1059 0306 892B      		or r24,r25
 1060               	.L145:
 253:tmk_core/common/action_tapping.c ****                         debug("Tapping: Tap press("); debug_dec(keyp->tap.count); debug(")\n");
 1061               		.loc 1 253 67 discriminator 1 view .LVU265
 1062 0308 1596      		adiw r26,5
 1063 030a 8C93      		st X,r24
 1064               	.L73:
 254:tmk_core/common/action_tapping.c ****                         process_record(keyp);
 1065               		.loc 1 254 53 is_stmt 1 view .LVU266
 254:tmk_core/common/action_tapping.c ****                         process_record(keyp);
 1066               		.loc 1 254 81 view .LVU267
 254:tmk_core/common/action_tapping.c ****                         process_record(keyp);
 1067               		.loc 1 254 95 view .LVU268
 255:tmk_core/common/action_tapping.c ****                         tapping_key = *keyp;
 1068               		.loc 1 255 25 view .LVU269
 1069 030c C801      		movw r24,r16
 1070 030e 0E94 0000 		call process_record
 1071               	.LVL61:
 256:tmk_core/common/action_tapping.c ****                         debug_tapping_key();
 1072               		.loc 1 256 25 view .LVU270
 256:tmk_core/common/action_tapping.c ****                         debug_tapping_key();
 1073               		.loc 1 256 37 is_stmt 0 view .LVU271
 1074 0312 86E0      		ldi r24,lo8(6)
 1075 0314 F801      		movw r30,r16
 1076 0316 A0E0      		ldi r26,lo8(tapping_key)
 1077 0318 B0E0      		ldi r27,hi8(tapping_key)
 1078               		0:
 1079 031a 0190      		ld r0,Z+
 1080 031c 0D92      		st X+,r0
 1081 031e 8A95      		dec r24
 1082 0320 01F4      		brne 0b
 257:tmk_core/common/action_tapping.c ****                         return true;
 1083               		.loc 1 257 25 is_stmt 1 view .LVU272
 1084               	.LVL62:
 1085               	.L140:
 300:tmk_core/common/action_tapping.c ****             return true;
 1086               		.loc 1 300 13 view .LVU273
 1087 0322 0E94 0000 		call debug_tapping_key
 1088               	.LVL63:
 301:tmk_core/common/action_tapping.c ****         } else {
 1089               		.loc 1 301 13 view .LVU274
 301:tmk_core/common/action_tapping.c ****         } else {
 1090               		.loc 1 301 20 is_stmt 0 view .LVU275
 1091 0326 00C0      		rjmp .L35
 1092               	.LVL64:
 1093               	.L65:
 246:tmk_core/common/action_tapping.c ****             if (event.pressed) {
 1094               		.loc 1 246 13 discriminator 2 view .LVU276
 1095 0328 8095      		com r24
 1096 032a 9095      		com r25
 1097 032c 8A0D      		add r24,r10
 1098 032e 9B1D      		adc r25,r11
 1099 0330 00C0      		rjmp .L144
 1100               	.L72:
 262:tmk_core/common/action_tapping.c ****                     return true;
 1101               		.loc 1 262 21 is_stmt 1 view .LVU277
 262:tmk_core/common/action_tapping.c ****                     return true;
 1102               		.loc 1 262 33 is_stmt 0 view .LVU278
 1103 0332 86E0      		ldi r24,lo8(6)
 1104 0334 F801      		movw r30,r16
 1105 0336 A0E0      		ldi r26,lo8(tapping_key)
 1106 0338 B0E0      		ldi r27,hi8(tapping_key)
 1107               		0:
 1108 033a 0190      		ld r0,Z+
 1109 033c 0D92      		st X+,r0
 1110 033e 8A95      		dec r24
 1111 0340 01F4      		brne 0b
 263:tmk_core/common/action_tapping.c ****                 } else if (is_tap_key(event.key)) {
 1112               		.loc 1 263 21 is_stmt 1 view .LVU279
 263:tmk_core/common/action_tapping.c ****                 } else if (is_tap_key(event.key)) {
 1113               		.loc 1 263 28 is_stmt 0 view .LVU280
 1114 0342 00C0      		rjmp .L35
 1115               	.L71:
 264:tmk_core/common/action_tapping.c ****                     // Sequential tap can be interfered with other tap key.
 1116               		.loc 1 264 24 is_stmt 1 view .LVU281
 264:tmk_core/common/action_tapping.c ****                     // Sequential tap can be interfered with other tap key.
 1117               		.loc 1 264 28 is_stmt 0 view .LVU282
 1118 0344 DD86      		std Y+13,r13
 1119 0346 EE86      		std Y+14,r14
 1120 0348 8D85      		ldd r24,Y+13
 1121 034a 9E85      		ldd r25,Y+14
 1122 034c 0E94 0000 		call is_tap_key
 1123               	.LVL65:
 264:tmk_core/common/action_tapping.c ****                     // Sequential tap can be interfered with other tap key.
 1124               		.loc 1 264 27 view .LVU283
 1125 0350 8111      		cpse r24,__zero_reg__
 1126 0352 00C0      		rjmp .L61
 274:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 1127               		.loc 1 274 21 is_stmt 1 view .LVU284
 274:tmk_core/common/action_tapping.c ****                     process_record(keyp);
 1128               		.loc 1 274 49 is_stmt 0 view .LVU285
 1129 0354 8091 0000 		lds r24,tapping_key+5
 1130 0358 8160      		ori r24,lo8(1<<0)
 1131 035a 8093 0000 		sts tapping_key+5,r24
 275:tmk_core/common/action_tapping.c ****                     return true;
 1132               		.loc 1 275 21 is_stmt 1 view .LVU286
 1133 035e C801      		movw r24,r16
 1134 0360 0E94 0000 		call process_record
 1135               	.LVL66:
 276:tmk_core/common/action_tapping.c ****                 }
 1136               		.loc 1 276 21 view .LVU287
 276:tmk_core/common/action_tapping.c ****                 }
 1137               		.loc 1 276 28 is_stmt 0 view .LVU288
 1138 0364 00C0      		rjmp .L35
 1139               	.L69:
 286:tmk_core/common/action_tapping.c ****             debug_event(event); debug("\n");
 1140               		.loc 1 286 70 is_stmt 1 view .LVU289
 287:tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
 1141               		.loc 1 287 13 view .LVU290
 287:tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
 1142               		.loc 1 287 13 is_stmt 0 view .LVU291
 1143 0366 7A2D      		mov r23,r10
 1144 0368 B98A      		std Y+17,r11
 1145 036a A88A      		std Y+16,r10
 1146 036c 4D2D      		mov r20,r13
 1147 036e 5E2D      		mov r21,r14
 1148 0370 6C2D      		mov r22,r12
 1149 0372 8989      		ldd r24,Y+17
 1150 0374 0E94 0000 		call debug_event
 1151               	.LVL67:
 1152 0378 00C0      		rjmp .L146
 1153               	.LVL68:
 1154               	.L36:
 295:tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 1155               		.loc 1 295 9 is_stmt 1 view .LVU292
 295:tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 1156               		.loc 1 295 12 is_stmt 0 view .LVU293
 1157 037a CC20      		tst r12
 1158 037c 01F4      		brne .+2
 1159 037e 00C0      		rjmp .L70
 295:tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 1160               		.loc 1 295 30 discriminator 1 view .LVU294
 1161 0380 DD86      		std Y+13,r13
 1162 0382 EE86      		std Y+14,r14
 1163 0384 8D85      		ldd r24,Y+13
 1164 0386 9E85      		ldd r25,Y+14
 1165 0388 0E94 0000 		call is_tap_key
 1166               	.LVL69:
 295:tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 1167               		.loc 1 295 30 discriminator 1 view .LVU295
 1168 038c F82E      		mov r15,r24
 295:tmk_core/common/action_tapping.c ****             debug("Tapping: Start(Press tap key).\n");
 1169               		.loc 1 295 27 discriminator 1 view .LVU296
 1170 038e 8823      		tst r24
 1171 0390 01F4      		brne .+2
 1172 0392 00C0      		rjmp .L70
 296:tmk_core/common/action_tapping.c ****             tapping_key = *keyp;
 1173               		.loc 1 296 54 is_stmt 1 view .LVU297
 297:tmk_core/common/action_tapping.c ****             process_record_tap_hint(&tapping_key);
 1174               		.loc 1 297 13 view .LVU298
 297:tmk_core/common/action_tapping.c ****             process_record_tap_hint(&tapping_key);
 1175               		.loc 1 297 25 is_stmt 0 view .LVU299
 1176 0394 86E0      		ldi r24,lo8(6)
 1177 0396 F801      		movw r30,r16
 1178 0398 A0E0      		ldi r26,lo8(tapping_key)
 1179 039a B0E0      		ldi r27,hi8(tapping_key)
 1180               		0:
 1181 039c 0190      		ld r0,Z+
 1182 039e 0D92      		st X+,r0
 1183 03a0 8A95      		dec r24
 1184 03a2 01F4      		brne 0b
 298:tmk_core/common/action_tapping.c ****             waiting_buffer_scan_tap();
 1185               		.loc 1 298 13 is_stmt 1 view .LVU300
 1186 03a4 80E0      		ldi r24,lo8(tapping_key)
 1187 03a6 90E0      		ldi r25,hi8(tapping_key)
 1188 03a8 0E94 0000 		call process_record_tap_hint
 1189               	.LVL70:
 299:tmk_core/common/action_tapping.c ****             debug_tapping_key();
 1190               		.loc 1 299 13 view .LVU301
 1191 03ac 0E94 0000 		call waiting_buffer_scan_tap
 1192               	.LVL71:
 1193 03b0 00C0      		rjmp .L140
 1194               	.LVL72:
 1195               	.L50:
 1196               	.LBB41:
 1197               	.LBB39:
 1198               		.loc 2 51 79 is_stmt 0 view .LVU302
 1199 03b2 81E0      		ldi r24,lo8(1)
 1200 03b4 8C25      		eor r24,r12
 1201 03b6 00C0      		rjmp .L49
 1202               	.LVL73:
 1203               	.L47:
 1204               		.loc 2 51 79 view .LVU303
 1205               	.LBE39:
 1206               	.LBE41:
 1207               	.LBB42:
 1208               	.LBB34:
 1209 03b8 81E0      		ldi r24,lo8(1)
 1210 03ba 8C25      		eor r24,r12
 1211 03bc 00C0      		rjmp .L46
 1212               	.LBE34:
 1213               	.LBE42:
 1214               		.cfi_endproc
 1215               	.LFE6:
 1217               		.section	.text.get_tapping_term,"ax",@progbits
 1218               		.weak	get_tapping_term
 1220               	get_tapping_term:
 1221               	.LVL74:
 1222               	.LFB4:
  23:tmk_core/common/action_tapping.c ****   return TAPPING_TERM;
 1223               		.loc 1 23 45 is_stmt 1 view -0
 1224               		.cfi_startproc
 1225               	/* prologue: function */
 1226               	/* frame size = 0 */
 1227               	/* stack size = 0 */
 1228               	.L__stack_usage = 0
  24:tmk_core/common/action_tapping.c **** }
 1229               		.loc 1 24 3 view .LVU305
  25:tmk_core/common/action_tapping.c **** 
 1230               		.loc 1 25 1 is_stmt 0 view .LVU306
 1231 0000 81E9      		ldi r24,lo8(-111)
 1232 0002 90E0      		ldi r25,0
 1233               	.LVL75:
 1234               	/* epilogue start */
  25:tmk_core/common/action_tapping.c **** 
 1235               		.loc 1 25 1 view .LVU307
 1236 0004 0895      		ret
 1237               		.cfi_endproc
 1238               	.LFE4:
 1240               		.section	.text.action_tapping_process,"ax",@progbits
 1241               	.global	action_tapping_process
 1243               	action_tapping_process:
 1244               	.LFB5:
  53:tmk_core/common/action_tapping.c ****     if (process_tapping(&record)) {
 1245               		.loc 1 53 1 is_stmt 1 view -0
 1246               		.cfi_startproc
 1247 0000 1F93      		push r17
 1248               	.LCFI19:
 1249               		.cfi_def_cfa_offset 3
 1250               		.cfi_offset 17, -2
 1251 0002 CF93      		push r28
 1252               	.LCFI20:
 1253               		.cfi_def_cfa_offset 4
 1254               		.cfi_offset 28, -3
 1255 0004 DF93      		push r29
 1256               	.LCFI21:
 1257               		.cfi_def_cfa_offset 5
 1258               		.cfi_offset 29, -4
 1259 0006 CDB7      		in r28,__SP_L__
 1260 0008 DEB7      		in r29,__SP_H__
 1261               	.LCFI22:
 1262               		.cfi_def_cfa_register 28
 1263 000a 2C97      		sbiw r28,12
 1264               	.LCFI23:
 1265               		.cfi_def_cfa_offset 17
 1266 000c 0FB6      		in __tmp_reg__,__SREG__
 1267 000e F894      		cli
 1268 0010 DEBF      		out __SP_H__,r29
 1269 0012 0FBE      		out __SREG__,__tmp_reg__
 1270 0014 CDBF      		out __SP_L__,r28
 1271               	/* prologue: function */
 1272               	/* frame size = 12 */
 1273               	/* stack size = 15 */
 1274               	.L__stack_usage = 15
 1275 0016 4F83      		std Y+7,r20
 1276 0018 5887      		std Y+8,r21
 1277 001a 6987      		std Y+9,r22
 1278 001c 7A87      		std Y+10,r23
 1279 001e 8B87      		std Y+11,r24
 1280 0020 9C87      		std Y+12,r25
  54:tmk_core/common/action_tapping.c ****         if (!IS_NOEVENT(record.event)) {
 1281               		.loc 1 54 5 view .LVU309
  54:tmk_core/common/action_tapping.c ****         if (!IS_NOEVENT(record.event)) {
 1282               		.loc 1 54 9 is_stmt 0 view .LVU310
 1283 0022 CE01      		movw r24,r28
 1284 0024 0796      		adiw r24,7
 1285 0026 0E94 0000 		call process_tapping
 1286               	.LVL76:
  54:tmk_core/common/action_tapping.c ****         if (!IS_NOEVENT(record.event)) {
 1287               		.loc 1 54 8 view .LVU311
 1288 002a 8823      		tst r24
 1289 002c 01F0      		breq .L149
  55:tmk_core/common/action_tapping.c ****             debug("processed: "); debug_record(record); debug("\n");
 1290               		.loc 1 55 9 is_stmt 1 view .LVU312
 1291               	.LBB51:
 1292               	.LBI51:
  49:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1293               		.loc 2 49 20 view .LVU313
 1294               	.LBB52:
  49:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1295               		.loc 2 49 51 view .LVU314
  49:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1296               		.loc 2 49 74 is_stmt 0 view .LVU315
 1297 002e 8A85      		ldd r24,Y+10
 1298 0030 9B85      		ldd r25,Y+11
 1299 0032 892B      		or r24,r25
 1300 0034 01F0      		breq .L150
 1301 0036 4F81      		ldd r20,Y+7
 1302 0038 5885      		ldd r21,Y+8
 1303 003a 842F      		mov r24,r20
 1304 003c 8523      		and r24,r21
 1305 003e 8F3F      		cpi r24,lo8(-1)
 1306 0040 01F0      		breq .+2
 1307 0042 00C0      		rjmp .L172
 1308               	.L150:
 1309               	.LBE52:
 1310               	.LBE51:
  73:tmk_core/common/action_tapping.c ****             debug("processed: waiting_buffer["); debug_dec(waiting_buffer_tail); debug("] = ");
 1311               		.loc 1 73 13 discriminator 1 view .LVU316
 1312 0044 16E0      		ldi r17,lo8(6)
 1313 0046 00C0      		rjmp .L157
 1314               	.L149:
  59:tmk_core/common/action_tapping.c ****             // clear all in case of overflow.
 1315               		.loc 1 59 9 is_stmt 1 view .LVU317
 1316 0048 86E0      		ldi r24,lo8(6)
 1317 004a FE01      		movw r30,r28
 1318 004c 3796      		adiw r30,7
 1319 004e DE01      		movw r26,r28
 1320 0050 1196      		adiw r26,1
 1321               		0:
 1322 0052 0190      		ld r0,Z+
 1323 0054 0D92      		st X+,r0
 1324 0056 8A95      		dec r24
 1325 0058 01F4      		brne 0b
 1326               	.LVL77:
 1327               	.LBB53:
 1328               	.LBI53:
 314:tmk_core/common/action_tapping.c **** {
 1329               		.loc 1 314 6 view .LVU318
 1330               	.LBB54:
 316:tmk_core/common/action_tapping.c ****         return true;
 1331               		.loc 1 316 5 view .LVU319
 1332               	.LBB55:
 1333               	.LBI55:
  49:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1334               		.loc 2 49 20 view .LVU320
 1335               	.LBB56:
  49:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1336               		.loc 2 49 51 view .LVU321
  49:tmk_core/common/keyboard.h **** static inline bool IS_PRESSED(keyevent_t event) { return (!IS_NOEVENT(event) && event.pressed); }
 1337               		.loc 2 49 74 is_stmt 0 view .LVU322
 1338 005a 8A85      		ldd r24,Y+10
 1339 005c 9B85      		ldd r25,Y+11
 1340 005e 892B      		or r24,r25
 1341 0060 01F0      		breq .L150
 1342 0062 8885      		ldd r24,Y+8
 1343 0064 9F81      		ldd r25,Y+7
 1344 0066 8923      		and r24,r25
 1345 0068 8F3F      		cpi r24,lo8(-1)
 1346 006a 01F0      		breq .L150
 1347               	.LBE56:
 1348               	.LBE55:
 320:tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1349               		.loc 1 320 5 is_stmt 1 view .LVU323
 320:tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1350               		.loc 1 320 30 is_stmt 0 view .LVU324
 1351 006c 2091 0000 		lds r18,waiting_buffer_head
 1352 0070 30E0      		ldi r19,0
 1353 0072 C901      		movw r24,r18
 1354 0074 0196      		adiw r24,1
 320:tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1355               		.loc 1 320 35 view .LVU325
 1356 0076 8770      		andi r24,7
 1357 0078 9927      		clr r25
 320:tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1358               		.loc 1 320 57 view .LVU326
 1359 007a 4091 0000 		lds r20,waiting_buffer_tail
 320:tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1360               		.loc 1 320 8 view .LVU327
 1361 007e 4817      		cp r20,r24
 1362 0080 1906      		cpc __zero_reg__,r25
 1363 0082 01F4      		brne .L174
 1364               	.LVL78:
 320:tmk_core/common/action_tapping.c ****         debug("waiting_buffer_enq: Over flow.\n");
 1365               		.loc 1 320 8 view .LVU328
 1366               	.LBE54:
 1367               	.LBE53:
  61:tmk_core/common/action_tapping.c ****             clear_keyboard();
 1368               		.loc 1 61 50 is_stmt 1 view .LVU329
  62:tmk_core/common/action_tapping.c ****             waiting_buffer_clear();
 1369               		.loc 1 62 13 view .LVU330
 1370 0084 0E94 0000 		call clear_keyboard
 1371               	.LVL79:
  63:tmk_core/common/action_tapping.c ****             tapping_key = (keyrecord_t){};
 1372               		.loc 1 63 13 view .LVU331
 1373               	.LBB58:
 1374               	.LBI58:
 336:tmk_core/common/action_tapping.c **** {
 1375               		.loc 1 336 6 view .LVU332
 1376               	.LBB59:
 338:tmk_core/common/action_tapping.c ****     waiting_buffer_tail = 0;
 1377               		.loc 1 338 5 view .LVU333
 338:tmk_core/common/action_tapping.c ****     waiting_buffer_tail = 0;
 1378               		.loc 1 338 25 is_stmt 0 view .LVU334
 1379 0088 1092 0000 		sts waiting_buffer_head,__zero_reg__
 339:tmk_core/common/action_tapping.c **** }
 1380               		.loc 1 339 5 is_stmt 1 view .LVU335
 339:tmk_core/common/action_tapping.c **** }
 1381               		.loc 1 339 25 is_stmt 0 view .LVU336
 1382 008c 1092 0000 		sts waiting_buffer_tail,__zero_reg__
 1383               	.LBE59:
 1384               	.LBE58:
  64:tmk_core/common/action_tapping.c ****         }
 1385               		.loc 1 64 13 is_stmt 1 view .LVU337
  64:tmk_core/common/action_tapping.c ****         }
 1386               		.loc 1 64 25 is_stmt 0 view .LVU338
 1387 0090 86E0      		ldi r24,lo8(6)
 1388 0092 E0E0      		ldi r30,lo8(tapping_key)
 1389 0094 F0E0      		ldi r31,hi8(tapping_key)
 1390 0096 DF01      		movw r26,r30
 1391               		0:
 1392 0098 1D92      		st X+,__zero_reg__
 1393 009a 8A95      		dec r24
 1394 009c 01F4      		brne 0b
 1395 009e 00C0      		rjmp .L150
 1396               	.LVL80:
 1397               	.L174:
 1398               	.LBB60:
 1399               	.LBB57:
 325:tmk_core/common/action_tapping.c ****     waiting_buffer_head = (waiting_buffer_head + 1) % WAITING_BUFFER_SIZE;
 1400               		.loc 1 325 5 is_stmt 1 view .LVU339
 325:tmk_core/common/action_tapping.c ****     waiting_buffer_head = (waiting_buffer_head + 1) % WAITING_BUFFER_SIZE;
 1401               		.loc 1 325 41 is_stmt 0 view .LVU340
 1402 00a0 96E0      		ldi r25,lo8(6)
 1403               	.LVL81:
 325:tmk_core/common/action_tapping.c ****     waiting_buffer_head = (waiting_buffer_head + 1) % WAITING_BUFFER_SIZE;
 1404               		.loc 1 325 41 view .LVU341
 1405 00a2 929F      		mul r25,r18
 1406 00a4 D001      		movw r26,r0
 1407 00a6 939F      		mul r25,r19
 1408 00a8 B00D      		add r27,r0
 1409 00aa 1124      		clr __zero_reg__
 1410 00ac A050      		subi r26,lo8(-(waiting_buffer))
 1411 00ae B040      		sbci r27,hi8(-(waiting_buffer))
 1412 00b0 FE01      		movw r30,r28
 1413 00b2 3196      		adiw r30,1
 1414               		0:
 1415 00b4 0190      		ld r0,Z+
 1416 00b6 0D92      		st X+,r0
 1417 00b8 9A95      		dec r25
 1418 00ba 01F4      		brne 0b
 326:tmk_core/common/action_tapping.c **** 
 1419               		.loc 1 326 5 is_stmt 1 view .LVU342
 326:tmk_core/common/action_tapping.c **** 
 1420               		.loc 1 326 25 is_stmt 0 view .LVU343
 1421 00bc 8093 0000 		sts waiting_buffer_head,r24
 328:tmk_core/common/action_tapping.c ****     return true;
 1422               		.loc 1 328 34 is_stmt 1 view .LVU344
 328:tmk_core/common/action_tapping.c ****     return true;
 1423               		.loc 1 328 36 view .LVU345
 1424 00c0 0E94 0000 		call debug_waiting_buffer
 1425               	.LVL82:
 329:tmk_core/common/action_tapping.c **** }
 1426               		.loc 1 329 5 view .LVU346
 329:tmk_core/common/action_tapping.c **** }
 1427               		.loc 1 329 5 is_stmt 0 view .LVU347
 1428 00c4 00C0      		rjmp .L150
 1429               	.L155:
 329:tmk_core/common/action_tapping.c **** }
 1430               		.loc 1 329 5 view .LVU348
 1431               	.LBE57:
 1432               	.LBE60:
  73:tmk_core/common/action_tapping.c ****             debug("processed: waiting_buffer["); debug_dec(waiting_buffer_tail); debug("] = ");
 1433               		.loc 1 73 9 is_stmt 1 view .LVU349
  73:tmk_core/common/action_tapping.c ****             debug("processed: waiting_buffer["); debug_dec(waiting_buffer_tail); debug("] = ");
 1434               		.loc 1 73 13 is_stmt 0 view .LVU350
 1435 00c6 819F      		mul r24,r17
 1436 00c8 C001      		movw r24,r0
 1437 00ca 1124      		clr __zero_reg__
 1438 00cc 8050      		subi r24,lo8(-(waiting_buffer))
 1439 00ce 9040      		sbci r25,hi8(-(waiting_buffer))
 1440 00d0 0E94 0000 		call process_tapping
 1441               	.LVL83:
  73:tmk_core/common/action_tapping.c ****             debug("processed: waiting_buffer["); debug_dec(waiting_buffer_tail); debug("] = ");
 1442               		.loc 1 73 12 view .LVU351
 1443 00d4 8823      		tst r24
 1444 00d6 01F0      		breq .L148
  74:tmk_core/common/action_tapping.c ****             debug_record(waiting_buffer[waiting_buffer_tail]); debug("\n\n");
 1445               		.loc 1 74 48 is_stmt 1 view .LVU352
  74:tmk_core/common/action_tapping.c ****             debug_record(waiting_buffer[waiting_buffer_tail]); debug("\n\n");
 1446               		.loc 1 74 80 view .LVU353
  74:tmk_core/common/action_tapping.c ****             debug_record(waiting_buffer[waiting_buffer_tail]); debug("\n\n");
 1447               		.loc 1 74 95 view .LVU354
  75:tmk_core/common/action_tapping.c ****         } else {
 1448               		.loc 1 75 13 view .LVU355
 1449 00d8 E091 0000 		lds r30,waiting_buffer_tail
 1450 00dc 1E9F      		mul r17,r30
 1451 00de F001      		movw r30,r0
 1452 00e0 1124      		clr __zero_reg__
 1453 00e2 E050      		subi r30,lo8(-(waiting_buffer))
 1454 00e4 F040      		sbci r31,hi8(-(waiting_buffer))
 1455 00e6 4081      		ld r20,Z
 1456 00e8 5181      		ldd r21,Z+1
 1457 00ea 6281      		ldd r22,Z+2
 1458 00ec 7381      		ldd r23,Z+3
 1459 00ee 8481      		ldd r24,Z+4
 1460 00f0 9581      		ldd r25,Z+5
 1461 00f2 0E94 0000 		call debug_record
 1462               	.LVL84:
  75:tmk_core/common/action_tapping.c ****         } else {
 1463               		.loc 1 75 77 view .LVU356
  72:tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1464               		.loc 1 72 99 is_stmt 0 view .LVU357
 1465 00f6 8091 0000 		lds r24,waiting_buffer_tail
 1466 00fa 90E0      		ldi r25,0
 1467 00fc 0196      		adiw r24,1
  72:tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1468               		.loc 1 72 104 view .LVU358
 1469 00fe 8770      		andi r24,7
 1470 0100 9927      		clr r25
  72:tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1471               		.loc 1 72 76 view .LVU359
 1472 0102 8093 0000 		sts waiting_buffer_tail,r24
 1473               	.L157:
  72:tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1474               		.loc 1 72 32 discriminator 1 view .LVU360
 1475 0106 8091 0000 		lds r24,waiting_buffer_tail
  72:tmk_core/common/action_tapping.c ****         if (process_tapping(&waiting_buffer[waiting_buffer_tail])) {
 1476               		.loc 1 72 5 discriminator 1 view .LVU361
 1477 010a 9091 0000 		lds r25,waiting_buffer_head
 1478 010e 8913      		cpse r24,r25
 1479 0110 00C0      		rjmp .L155
 1480               	.L148:
 1481               	/* epilogue start */
  83:tmk_core/common/action_tapping.c **** 
 1482               		.loc 1 83 1 view .LVU362
 1483 0112 2C96      		adiw r28,12
 1484 0114 0FB6      		in __tmp_reg__,__SREG__
 1485 0116 F894      		cli
 1486 0118 DEBF      		out __SP_H__,r29
 1487 011a 0FBE      		out __SREG__,__tmp_reg__
 1488 011c CDBF      		out __SP_L__,r28
 1489 011e DF91      		pop r29
 1490 0120 CF91      		pop r28
 1491 0122 1F91      		pop r17
 1492 0124 0895      		ret
 1493               	.L172:
  56:tmk_core/common/action_tapping.c ****         }
 1494               		.loc 1 56 33 is_stmt 1 view .LVU363
  56:tmk_core/common/action_tapping.c ****         }
 1495               		.loc 1 56 35 view .LVU364
 1496 0126 6985      		ldd r22,Y+9
 1497 0128 7A85      		ldd r23,Y+10
 1498 012a 8B85      		ldd r24,Y+11
 1499 012c 9C85      		ldd r25,Y+12
 1500 012e 0E94 0000 		call debug_record
 1501               	.LVL85:
 1502 0132 00C0      		rjmp .L150
 1503               		.cfi_endproc
 1504               	.LFE5:
 1506               		.section	.bss.waiting_buffer_tail,"aw",@nobits
 1509               	waiting_buffer_tail:
 1510 0000 00        		.zero	1
 1511               		.section	.bss.waiting_buffer_head,"aw",@nobits
 1514               	waiting_buffer_head:
 1515 0000 00        		.zero	1
 1516               		.section	.bss.waiting_buffer,"aw",@nobits
 1519               	waiting_buffer:
 1520 0000 0000 0000 		.zero	48
 1520      0000 0000 
 1520      0000 0000 
 1520      0000 0000 
 1520      0000 0000 
 1521               		.section	.bss.tapping_key,"aw",@nobits
 1524               	tapping_key:
 1525 0000 0000 0000 		.zero	6
 1525      0000 
 1526               		.text
 1527               	.Letext0:
 1528               		.file 3 "/usr/local/Cellar/avr-gcc/8.1.0/avr/include/stdint.h"
 1529               		.file 4 "tmk_core/common/keycode.h"
 1530               		.file 5 "tmk_core/common/action_code.h"
 1531               		.file 6 "tmk_core/common/action.h"
 1532               		.file 7 "tmk_core/common/action_layer.h"
 1533               		.file 8 "tmk_core/common/timer.h"
 1534               		.file 9 "tmk_core/common/debug.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 action_tapping.c
/var/folders/_c/44sm70yj4mq2k0mvzts6tsbc0000gn/T//cc0RMoFc.s:2      *ABS*:000000000000003e __SP_H__
/var/folders/_c/44sm70yj4mq2k0mvzts6tsbc0000gn/T//cc0RMoFc.s:3      *ABS*:000000000000003d __SP_L__
/var/folders/_c/44sm70yj4mq2k0mvzts6tsbc0000gn/T//cc0RMoFc.s:4      *ABS*:000000000000003f __SREG__
/var/folders/_c/44sm70yj4mq2k0mvzts6tsbc0000gn/T//cc0RMoFc.s:5      *ABS*:0000000000000000 __tmp_reg__
/var/folders/_c/44sm70yj4mq2k0mvzts6tsbc0000gn/T//cc0RMoFc.s:6      *ABS*:0000000000000001 __zero_reg__
/var/folders/_c/44sm70yj4mq2k0mvzts6tsbc0000gn/T//cc0RMoFc.s:12     .text.debug_waiting_buffer:0000000000000000 debug_waiting_buffer
/var/folders/_c/44sm70yj4mq2k0mvzts6tsbc0000gn/T//cc0RMoFc.s:1509   .bss.waiting_buffer_tail:0000000000000000 waiting_buffer_tail
/var/folders/_c/44sm70yj4mq2k0mvzts6tsbc0000gn/T//cc0RMoFc.s:1514   .bss.waiting_buffer_head:0000000000000000 waiting_buffer_head
/var/folders/_c/44sm70yj4mq2k0mvzts6tsbc0000gn/T//cc0RMoFc.s:1519   .bss.waiting_buffer:0000000000000000 waiting_buffer
/var/folders/_c/44sm70yj4mq2k0mvzts6tsbc0000gn/T//cc0RMoFc.s:94     .text.debug_tapping_key:0000000000000000 debug_tapping_key
/var/folders/_c/44sm70yj4mq2k0mvzts6tsbc0000gn/T//cc0RMoFc.s:1524   .bss.tapping_key:0000000000000000 tapping_key
/var/folders/_c/44sm70yj4mq2k0mvzts6tsbc0000gn/T//cc0RMoFc.s:117    .text.waiting_buffer_typed.isra.1:0000000000000000 waiting_buffer_typed.isra.1
/var/folders/_c/44sm70yj4mq2k0mvzts6tsbc0000gn/T//cc0RMoFc.s:190    .text.waiting_buffer_scan_tap:0000000000000000 waiting_buffer_scan_tap
/var/folders/_c/44sm70yj4mq2k0mvzts6tsbc0000gn/T//cc0RMoFc.s:369    .text.process_tapping:0000000000000000 process_tapping
/var/folders/_c/44sm70yj4mq2k0mvzts6tsbc0000gn/T//cc0RMoFc.s:1220   .text.get_tapping_term:0000000000000000 get_tapping_term
/var/folders/_c/44sm70yj4mq2k0mvzts6tsbc0000gn/T//cc0RMoFc.s:1243   .text.action_tapping_process:0000000000000000 action_tapping_process

UNDEFINED SYMBOLS
debug_record
process_record
layer_switch_get_action
is_tap_key
debug_event
process_record_tap_hint
clear_keyboard
__do_clear_bss
